<?xml version="1.0" encoding="UTF-8"?><html><head><meta charset="utf-8"/><title>How to run a custom powershell script with elevated privileges in a playbook</title><meta name="label" content="threat_manager"/><meta name="label" content="skb"/><meta name="KnowledgeArticleId" content="kA04u0000000K7UCAU"/><meta name="Id" content="ka04u000000HdClAAK"/><meta name="LastPublishedDate" content="2022-04-21T21:16:42.000+0000"/><meta name="LastModifiedDate" content="2023-05-08T10:18:55.000+0000"/><meta name="FirstPublishedDate" content="2022-04-21T21:16:42.000+0000"/><meta name="Language" content="en_US"/><meta name="UrlName" content="8418"/><meta name="ArticleNumber" content="000008418"/><meta name="description" content="A custom powershell script that requires elevated privilege's will not run, even if the credential profile has elevated privilege's."/></head><body><article class=" kb-articles"><div class="Content__c"><span><span><span><span><b><span><span><span>Summary:</span></span></span></b><span><span><span> How to run a custom powershell script with elevated privileges in a playbook</span></span></span></span></span></span></span><br/><span><span><span><span> </span></span></span></span><br/><span><span><span><span><b><span><span><span>Issue: </span></span></span></b><span><span><span>A custom powershell script that requires elevated privilege's will not run, even if the credential profile has elevated privilege's.</span></span></span></span></span></span></span><br/><span><span><span><span> </span></span></span></span><br/><span><span><span><span><b><span><span><span>Instructions:</span></span></span></b>  </span></span></span></span><br/><span><span><span><span><span><span><span>1. Upgrade the customer to 2.7 SP1 HF8 or greater</span></span></span></span></span></span></span><br/><span><span><span><span><span><span><span>2. In the actions Credential Profile select a profile that has elevated privileges.</span></span></span></span></span></span></span><br/><span><span><span><span><span><span><span>3. Put this line of code at the start of the script, and paste the rest of the former script into the code block.</span></span></span></span></span></span></span>
<div><span><span><span><span><span><span><span><span><span><span>Invoke-WithImpersonation -ScriptBlock { #Insert code in here }</span></span></span></span></span></span></span></span></span></span></div>
<br/> </div>
</article></body></html>