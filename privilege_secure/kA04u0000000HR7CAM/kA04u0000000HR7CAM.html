<?xml version="1.0" encoding="UTF-8"?><html><head><meta charset="utf-8"/><title>Add Active Directory Federation Services (AD FS) as an Authentication Connector (SAML)</title><meta name="label" content="privilege_secure"/><meta name="label" content="skb"/><meta name="KnowledgeArticleId" content="kA04u0000000HR7CAM"/><meta name="Id" content="ka04u000000wwIEAAY"/><meta name="LastPublishedDate" content="2021-10-12T13:38:36.000+0000"/><meta name="LastModifiedDate" content="2023-11-30T13:55:56.000+0000"/><meta name="FirstPublishedDate" content="2021-10-12T13:38:36.000+0000"/><meta name="Language" content="en_US"/><meta name="UrlName" content="5909"/><meta name="ArticleNumber" content="000005909"/><meta name="description" content="Add Active Directory Federation Services (AD FS) as an Authentication Connector (SAML)"/></head><body><article class=" kb-articles"><div class="Content__c"><h2 id="summary">Summary</h2>

<p>This article outlines the process of adding Active Directory Federation Services (AD FS) to SbPAM as an Authentication Connector via SAML. The article is split into two sections, <i><b>Steps for AD FS</b></i> and <i><b>Steps for SbPAM</b></i><em>. </em>The AD FS section must be completed first.</p>

<h2 id="instructions">Instructions</h2>

<h3 id="steps_for_active_directory_federation_services_ad_fs">Steps for Active Directory Federation Services (AD FS)</h3>

<ol><li>Launch <strong>AD FS Management</strong> on the AD FS server:<br/>	<br/>	<img alt="User-added image" src="kA04u0000000HR7CAM_aa9db58d-d26d-4d56-9bb9-4b8c2e80a7af.png"/><br/>	 </li><li>Right-click on <strong>Application Groups</strong> and select <strong>Add Application Group…<br/>	<br/>	<img alt="User-added image" src="kA04u0000000HR7CAM_f5e73366-e01b-4f15-868a-0d2ed33513e8.png"/></strong><br/>	 </li><li>Select<strong> Native application accessing a web API </strong>and enter "SbPAM (SAML)" as the <strong>Name</strong>, then click <strong>Next</strong>.<br/>	<br/>	<br/>	<strong><img alt="User-added image" src="kA04u0000000HR7CAM_c383e0b2-dbae-4fb3-acc0-4402349cda21.png"/></strong><br/>	 </li><li>Copy the <strong>Client Identifier</strong> value; you will need that when configuring SbPAM.<br/>	<br/>	<img alt="User-added image" src="kA04u0000000HR7CAM_3d7fe522-2231-419c-b210-4659e2cd771b.png"/><br/>	 </li><li>For the <strong>Redirect URI</strong>, use the following URI with the hostname of the SbPAM server customized to match your environment. For example: <strong>https://&lt;sbpam-server&gt;:6500/samlSigninCallback</strong>. Click <strong>Add</strong>, then <strong>Next</strong>.<br/>	<br/>	<strong><img alt="User-added image" src="kA04u0000000HR7CAM_e52be568-5733-44f0-b6e5-a198ace2a842.png"/></strong><br/>	 </li><li>For the <strong>Identifier </strong>of the Web API, enter <strong>sbpamsaml.stealthbits.com</strong>, click <strong>Add</strong>, then click <strong>Next</strong>.<br/>	<br/>	<strong><img alt="User-added image" src="kA04u0000000HR7CAM_7e5ca8ed-989a-46b1-a622-7e35e2ad0379.png"/></strong><br/>	 </li><li>For <strong>Apply Access Control Policy</strong>, leave all defaults and then click <strong>Next</strong>.<br/>	<br/>	<img alt="User-added image" height="356" src="kA04u0000000HR7CAM_5af88a06-8e80-4228-9743-f96c7728041b.png" width="500"/><br/>	 </li><li>For <strong>Configure Application Permissions</strong>, enable the following and then click <strong>Next</strong>.<br/>	<br/>	• allatclaims<br/>	• email<br/>	• openid<br/>	• profile<br/>	<br/>	<strong><img alt="User-added image" height="305" src="kA04u0000000HR7CAM_595a5cd5-7c6e-40c8-a681-cc999356c516.png" width="500"/></strong><br/>	 </li><li>Click <strong>Next </strong>on the remaining pages until the wizard completes.<br/>	 </li><li>In the left sidebar of <strong>AD FS</strong>, click on the <strong>Relying Party Trusts</strong> folder. In the right sidebar, click <strong>Add Relying Party Trust...</strong><br/>	<br/>	<img alt="User-added image" src="kA04u0000000HR7CAM_ad32c021-6765-4551-8f9f-10f6763a2a1f.png"/></li><li>Select <strong>Claims aware</strong> and click <strong>Next</strong>.<br/>	<br/>	<img alt="User-added image" height="120" src="kA04u0000000HR7CAM_07b72b72-2bcf-451f-ac75-29ee6b5a7b86.png" width="500"/><br/>	 </li><li>For <strong>Select Data Source</strong>, select <strong>Enter data about the relying party manually</strong> and click <strong>Next</strong>.<br/>	 </li><li>For <strong>Specify Display Name</strong>, enter "SbPAM (SAML)" and click <strong>Next</strong>.<br/>	 </li><li>For <strong>Configure Certificate</strong>, leave the default values and click <strong>Next</strong>.<br/>	 </li><li>For <strong>Configure URL</strong>, check <strong>Enable support for the SAML 2.0 WebSSO protocol</strong> and enter your AD FS server's FQDN followed by "/adfs/ls". For example: <strong>https://adfs-server.domain.com/adfs/ls</strong>. Click <strong>Next</strong>.<br/>	<br/>	<img alt="User-added image" height="235" src="kA04u0000000HR7CAM_2c33b4b6-e6fb-4e42-b05b-6cfe2269b7dd.png" width="500"/><br/>	 </li><li>For <strong>Configure Identifiers</strong>, use the value <strong>sbpamsaml.stealthbits.com</strong>, click <strong>Add</strong>, then click <strong>Next</strong>.<br/>	<br/>	<img alt="User-added image" height="138" src="kA04u0000000HR7CAM_bd92e799-490d-4fcb-be09-b475664e9128.png" width="500"/><br/>	 </li><li>Leave <strong>Choose Access Control Policy</strong> as default values and click <strong>Next, </strong>then click <strong>Next</strong> through the remaining pages to finish the wizard.<br/>	 </li><li>When the wizard closes, it a window for <strong>Issuance Transform Rules</strong> will automatically open. Click <strong>Add Rule...</strong><br/>	 </li><li>Select <strong>Send LDAP Attributes as Claims</strong>, and click <strong>Next</strong>.<br/>	<br/>	<img alt="User-added image" height="71" src="kA04u0000000HR7CAM_7d7486a7-3eca-4b33-ad03-6e4cb70a9d25.png" width="500"/><br/>	 </li><li>Name the rule "Send attributes", select "Active Directory" as the <strong>Attribute store</strong>, map the following <strong>LDAP Attributes</strong> to <strong>Outgoing Claim Types</strong>, click <strong>Finish</strong>, then click <strong>Apply </strong>and <strong>OK</strong>.<br/>	<br/>	• SAM-Account-Name &gt; Name<br/>	• User-Principal-Name &gt; UPN<br/>	• E-Mail-Addresses &gt; E-Mail Address<br/>	<br/>	<img alt="User-added image" height="224" src="kA04u0000000HR7CAM_a0893740-ed2b-484b-98cd-9f92f581a5a0.png" width="500"/></li><li>Double-click on the <strong>Relying Party Trust</strong> created in the previous steps (named "SbPAM (SAML)"), and navigate to the <strong>Endpoints</strong> tab.<br/>	<br/>	<img alt="User-added image" src="kA04u0000000HR7CAM_6c193aa8-50b8-4b92-ad9c-6c687cb6dcf7.png"/><br/>	<br/>	Add the following endpoints (click <strong>Add SAML...</strong>):<br/>	<br/>	<strong>Endpoint type: </strong>SAML Assertion Consumer<br/>	<strong>Binding: </strong>POST<br/>	<strong>Index: </strong>0<br/>	<strong>Trusted URL: </strong>https://&lt;sbpam-server&gt;:6500/samlSigninCallback<br/>	<br/>	<img alt="User-added image" src="kA04u0000000HR7CAM_908e7575-7426-42ec-9936-93938e35c793.png"/><br/>	<br/>	<strong>Endpoint type: </strong>SAML Logout<br/>	<strong>Binding: </strong>POST<br/>	<strong>Index: </strong>0<br/>	<strong>Trusted URL: </strong>https://&lt;adfs-server&gt;.domain.com/adfs/ls/?wa=wsignout1.0&amp;wreply=https://&lt;sbpam-server&gt;:6500<br/>	<strong>Response URL: </strong>https://&lt;sbpam-server&gt;:6500/login<br/>	<br/>	<img alt="User-added image" src="kA04u0000000HR7CAM_5532b3fe-df7d-46cb-9d0d-2f30c7dcd82d.png"/><br/>	<br/>	Click <strong>OK</strong>, <strong>Apply</strong>, then <strong>OK</strong>.<br/>	 </li><li>This completes the AD FS configuration portion of the guide.</li></ol>

<h3 id="steps_for_sbpam">Steps for SbPAM</h3>

<p>Once the <i><b>Steps for AD FS</b></i> have been completed, take the following steps in SbPAM to add AD FS as an Authentication Connector via SAML.</p>

<ol><li>As an SbPAM Admin, navigate in SbPAM to <strong>Configuration &gt; Authentication</strong>, and click the green <strong>"+" </strong>button to add a new Authentication Connector.<br/>	 </li><li>Give the new connector a name, description (optional), and a Connector Type of "SAML".<br/>	<br/>	<img alt="User-added image" height="132" src="kA04u0000000HR7CAM_7f75f42a-4941-4114-bea8-5213f2a56a7a.png" width="500"/><br/>	 </li><li>Click on <strong>Configuration Wizard</strong>.<br/>	 </li><li>On the wizard's <strong>Configure Client</strong> page, enter the following values:<br/>	<br/>	<strong>Signin URI: </strong>https://&lt;adfs-server&gt;.domain.com/adfs/ls<br/>	<strong>Callback Address: </strong>https://&lt;sbpam-server&gt;:6500/samlSigninCallback<br/>	<strong>CORS: </strong>https://&lt;sbpam-server&gt;:6500<br/>	<br/>	<img alt="User-added image" height="234" src="kA04u0000000HR7CAM_560bebb0-9237-40a3-adc5-453689dc2cd2.png" width="500"/><br/>	<br/>	Click <strong>Test Connection</strong>. If brought to a log-in page, click <strong>Back</strong> in your web browser and then <strong>Next</strong> in the SbPAM wizard. If the page refreshes and brings you back to the SbPAM wizard, you should also click <strong>Next</strong> to proceed.<br/>	 </li><li>Select "Unspecified" for the <strong>Name ID Policy</strong>, and add a certificate if required. Then, click <strong>Login </strong>and sign-in to AD FS using Active Directory credentials.<br/>	<br/>	<img alt="User-added image" height="231" src="kA04u0000000HR7CAM_720cdb98-656e-4876-bf38-310fc897a951.png" width="500"/><br/>	<br/>	When redirected back to this page after signing-in to AD FS, if the message at the bottom reads "Login was successful" then click <strong>Next</strong>.<br/>	 </li><li>Locate a mapping you would like to use when users sign-in to SbPAM using AD FS, such as an email address or UPN.<br/>	<br/>	<img alt="User-added image" height="117" src="kA04u0000000HR7CAM_a80c36c3-cf5f-4d1d-979c-7c9fb750b06c.png" width="500"/><br/>	<br/>	Click on the mapping, click <strong>Select</strong>, select the matching Active Directory mapping from the displayed dropdown, then click <strong>Next</strong>.<br/>	<br/>	<img alt="User-added image" src="kA04u0000000HR7CAM_ea507bba-9a12-4dca-8413-ae5a33383569.png"/><br/>	 </li><li>For the <strong>Signout URI </strong>and <strong>Signout Callback URI</strong>, use the following values:<br/>	<br/>	<strong>Signout URI: </strong>https://&lt;adfs-server&gt;.domain.com/adfs/ls/?wa=wsignout1.0&amp;wreply=<br/>	<strong>Signout Callback URI:</strong> https://&lt;sbpam-server&gt;:6500<br/>	<br/>	<br/>	<img alt="User-added image" height="303" src="kA04u0000000HR7CAM_98435f91-f023-46d9-a705-93fbe9b4a66a.png" width="500"/><br/>	<br/>	Click <strong>Test Log Out</strong>, then <strong>Finish</strong> to complete the wizard. AD FS has now been added to SbPAM (via SAML) as an Authentication Connector.<br/>	 </li><li>The last step is to navigate to specific users in SbPAM's <strong>Users &amp; Groups </strong>menu, and assign the AD FS SAML authenticator.<br/>	<br/>	<img alt="User-added image" height="235" src="kA04u0000000HR7CAM_dd50b5ca-5220-45a1-910d-d4cacbf435b9.png" width="500"/></li></ol>

<p>When using the SAML log-in option, the user will be redirected to sign-in to AD FS. Upon successful authentication, the user will be redirected to the SbPAM UI as their now signed-in user.</p></div>
</article></body></html>