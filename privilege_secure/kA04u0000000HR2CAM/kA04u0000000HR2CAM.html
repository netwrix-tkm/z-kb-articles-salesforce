<?xml version="1.0" encoding="UTF-8"?><html><head><meta charset="utf-8"/><title>Add Active Directory Federation Services (AD FS) as an Authentication Connector (OpenID Connect)</title><meta name="label" content="skb"/><meta name="label" content="privilege_secure"/><meta name="KnowledgeArticleId" content="kA04u0000000HR2CAM"/><meta name="Id" content="ka04u000000HcZnAAK"/><meta name="LastPublishedDate" content="2021-11-10T18:36:06.000+0000"/><meta name="LastModifiedDate" content="2023-05-08T09:57:38.000+0000"/><meta name="FirstPublishedDate" content="2021-10-12T13:38:07.000+0000"/><meta name="Language" content="en_US"/><meta name="UrlName" content="5908"/><meta name="ArticleNumber" content="000005908"/><meta name="description" content="Add Active Directory Federation Services (AD FS) as an Authentication Connector (OpenID Connect)"/></head><body><article class=" kb-articles"><div class="Content__c"><h2 id="summary">Summary</h2>

<p>This article outlines the process of adding Active Directory Federation Services (AD FS) to SbPAM as an Authentication Connector via OpenID Connect (OIDC). The article is split into two sections, <i><b>Steps for AD FS</b></i> and <i><b>Steps for SbPAM</b></i><em>. </em>The AD FS section must be completed first.</p>

<h2 id="instructions">Instructions</h2>

<h3 id="h_01FDFQ6SZGRZ7A3H3VS53B8FMA">Steps for Active Directory Federation Services (AD FS)</h3>

<ol><li>Launch <strong>AD FS Management</strong> on the AD FS server:<br/>	<br/>	<img alt="User-added image" src="kA04u0000000HR2CAM_ec73bb7a-ae72-4cfe-bb72-0377fe24271a.png"/><br/>	 </li><li>Right-click on <strong>Application Groups</strong> and select <strong>Add Application Group…<br/>	<br/>	<img alt="User-added image" src="kA04u0000000HR2CAM_bb144edb-f216-47ba-96b4-96b03a8c2376.png"/></strong><br/>	 </li><li>Select<strong> Native application accessing a web API </strong>and enter "SbPAM (OIDC)" as the <strong>Name</strong>, then click <strong>Next</strong>.<br/>	<br/>	<strong><img alt="User-added image" src="kA04u0000000HR2CAM_78a56b9c-3c45-4ece-b5b6-00d842455781.png"/></strong><br/>	 </li><li>Copy the <strong>Client Identifier</strong> value; you will need that when configuring SbPAM.<br/>	<br/>	<strong><img alt="User-added image" src="kA04u0000000HR2CAM_635a9535-5c5a-41e8-8753-0e519be016fe.png"/></strong></li><li>For the <strong>Redirect URI</strong>, use the SbPAM server's URL followed by "/callback". For example: <strong>https://&lt;sbpam-server&gt;:6500/callback</strong>. Click <strong>Add</strong>, then <strong>Next</strong>.<br/>	<br/>	<img alt="User-added image" src="kA04u0000000HR2CAM_2b43a8a9-08e4-44dc-aef2-e62740578f10.png"/><br/>	 </li><li>For the <strong>Identifier </strong>of the Web API, use the SbPAM server's URL. Click <strong>Add</strong>, then click <strong>Next</strong>.<br/>	<br/>	<strong><img alt="User-added image" src="kA04u0000000HR2CAM_46ed3331-0301-46a5-b853-e057c3207a04.png"/></strong><br/>	 </li><li>For <strong>Apply Access Control Policy</strong>, leave all defaults and then click <strong>Next</strong>.<br/>	<br/>	<img alt="User-added image" height="358" src="kA04u0000000HR2CAM_f17f11a9-8584-4931-b22e-5358523698d0.png" width="500"/><br/>	 </li><li>For <strong>Configure Application Permissions</strong>, enable the following and then click <strong>Next</strong>.<br/>	<br/>	• allatclaims<br/>	• openid<br/>	• profile<br/>	<br/>	<strong><img alt="User-added image" height="360" src="kA04u0000000HR2CAM_24afb3f1-5227-467a-814b-939c1d29f34c.png" width="500"/></strong><br/>	 </li><li>Review the Summary, then click <strong>Finish</strong>.<br/>	 </li><li>Double-click on the newly created Application Group, then double-click on the Web API application, then navigate to the <strong>Issuance Transform Rules</strong> tab. Click <strong>Add Rule...</strong><br/>	<br/>	<img alt="User-added image" src="kA04u0000000HR2CAM_3231ecf9-673e-4bc6-bb85-fcbafaf85b4e.png"/><br/>	 </li><li>From the dropdown, select <strong>Send Claims Using a Custom Rule</strong> and click <strong>Next</strong>.<br/>	<br/>	<img alt="User-added image" height="192" src="kA04u0000000HR2CAM_84328f74-a27c-40c2-86d6-5979f937f447.png" width="500"/><br/>	 </li><li>Name the rule "Send attributes", and add the following custom rule:
	<pre>x:[]
  =‌&gt; issue(claim = x);</pre>
	<br/>	<img alt="User-added image" height="143" src="kA04u0000000HR2CAM_8b7417e9-b4c5-4179-943e-0adc7c6c5011.png" width="500"/><br/>	<br/>	Click <strong>Finish</strong>, <strong>Apply</strong>, <strong>OK,</strong> then <strong>OK</strong> again. You can now close <strong>AD</strong> <strong>FS</strong>.<br/>	 </li><li>Open <strong>PowerShell</strong> as an administrator, and run the following commands to enable CORS for communication between the SbPAM server and AD FS:<br/>	<br/>	Before running the commands, you should make sure you capture any existing CORS settings since the <strong>Set-AdfsResponseHeaders</strong> command will replace the existing values with the provided value.<br/>	 
	<pre>Set-AdfsResponseHeaders -EnableCORS $true
Set-AdfsResponseHeaders -CORSTrustedOrigins https://&lt;sbpam-server&gt;:6500</pre>
	</li><li>This completes the AD FS configuration portion of the guide.</li></ol>

<h3 id="steps_for_sbpam">Steps for SbPAM</h3>

<p>Once the <i><b>Steps for AD FS</b></i> have been completed, take the following steps in SbPAM to add AD FS as an Authentication Connector via OIDC.</p>

<ol><li>As an SbPAM Admin, navigate in SbPAM to <strong>Configuration &gt; Authentication</strong>, and click the green <strong>"+" </strong>button to add a new Authentication Connector.<br/>	 </li><li>Give the new connector a name, description (optional), and a Connector Type of "OpenID Connect".<br/>	<br/>	<img alt="User-added image" height="125" src="kA04u0000000HR2CAM_ae7399e2-3b71-4625-925d-00c06fc7e44f.png" width="500"/><br/>	 </li><li>Click on <strong>Configuration Wizard</strong>.<br/>	 </li><li>On the wizard's <strong>Configure Client</strong> page, enter the following values:<br/>	<br/>	<strong>Issue URI: </strong>https://&lt;adfs-server&gt;.domain.com/adfs<br/>	<strong>Client Id: </strong>The Client ID noted in the previous steps for <strong>AD FS</strong>.<br/>	<strong>Callback Address: </strong>https://&lt;sbpam-server&gt;:6500/callback<br/>	<strong>CORS: </strong>https://&lt;sbpam-server&gt;:6500<br/>	<br/>	<img alt="User-added image" height="121" src="kA04u0000000HR2CAM_bc0661a4-1dc9-4c9c-9135-99973e136408.png" width="500"/><br/>	 </li><li>Click <strong>Test Connection</strong>. If brought to a log-in page, click <strong>Back</strong> in your web browser and then <strong>Next</strong> in the SbPAM wizard. If the page refreshes and brings you back to the SbPAM wizard, you should also click <strong>Next</strong> to proceed.<br/>	 </li><li>On the <strong>Test Login</strong> page, click <strong>Login</strong>. You'll be brought to an AD FS log-in page. Log-in with Active Directory credentials, and you'll be brought back to the same page of the SbPAM wizard. Click <strong>Next</strong>.<br/>	 </li><li>Click <strong>Get User Data</strong>. Locate a mapping you would like to use when users sign-in to SbPAM using AD FS, such as an email address or UPN.<br/>	<br/>	<img alt="User-added image" height="172" src="kA04u0000000HR2CAM_58ab8656-a09e-4677-8a3b-c13d6f555c93.png" width="500"/><br/>	<br/>	Click on the mapping, click <strong>Select</strong>, select the matching Active Directory mapping from the displayed dropdown, then click <strong>Finish</strong>.<br/>	<br/>	<img alt="User-added image" height="160" src="kA04u0000000HR2CAM_fe1e6591-d816-4f12-8f6e-f026ab45320f.png" width="500"/></li><li>The last step is to navigate to specific users in SbPAM's <strong>Users &amp; Groups </strong>menu, and assign the AD FS OIDC authenticator.<br/>	<br/>	<img alt="User-added image" height="243" src="kA04u0000000HR2CAM_01238221-d57d-41dc-a7c4-625322fa6139.png" width="500"/></li></ol>

<p>When using the OIDC log-in option, the user will be redirected to log-in to AD FS. Upon successful authentication, the user will be redirected to the SbPAM UI as their now logged-in user.</p></div>
</article></body></html>