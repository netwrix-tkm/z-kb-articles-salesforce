<?xml version="1.0" encoding="UTF-8"?><html><head><meta charset="utf-8"/><title>How to Integrate Activities with Remote Desktop Services (RDS)</title><meta name="label" content="privilege_secure"/><meta name="label" content="skb"/><meta name="KnowledgeArticleId" content="kA04u0000000HZBCA2"/><meta name="Id" content="ka0Qk0000005qSbIAI"/><meta name="LastPublishedDate" content="2022-03-08T18:18:34.000+0000"/><meta name="LastModifiedDate" content="2024-09-30T18:31:21.000+0000"/><meta name="FirstPublishedDate" content="2021-11-15T14:30:25.000+0000"/><meta name="Language" content="en_US"/><meta name="UrlName" content="5923"/><meta name="ArticleNumber" content="000005923"/><meta name="description" content="This article outlines how to integrate Privilege Secure activities with Microsoft Remote Desktop Services (RDS), for launching interactive application sessions temporary elevated privileges."/></head><body><article class=" kb-articles"><div class="Content__c"><h2 id="summary">Summary</h2>

<p>This article outlines how to integrate Privilege Secure activities with Microsoft Remote Desktop Services (RDS), for launching interactive application sessions temporary elevated privileges.</p>

<h2 id="licensing">Licensing</h2>

<p>Remote Desktop Services will run without a license for a period determined by Microsoft. For long-term use, you are required to install and set up RDS licensing based either on named users or RDS client - this is not covered in this article.</p>

<h2 id="instructions">Instructions</h2>

<h3 id="configure_remote_desktop_services">Configure Remote Desktop Services</h3>

<p><br/>On the Remote Desktop Services/Terminal Services (RemoteApp) server launch <b>Server Manager</b>, click on the <b>Manager </b>tab and select <b>Add Roles and Features</b>.<br/><br/>Follow the wizard, select <b>Remote Desktop Services installation</b> and click <b>Next</b>.<br/><br/><img alt="Screenshot of Windows Server Add Roles and Features Wizard, demonstrating a Remote Desktop Services installation." height="356" src="kA04u0000000HZBCA2_560932ac-8080-4bb0-b95e-d0effa0898e8.png" width="500"/><br/><br/>Select either <b>Standard Deployment</b> (as in this guide) or <b>Quick Start</b> if you intend to install all RDS role services on the same server. Click <b>Next</b>.<br/><br/><img alt="Screenshot of Windows Server Add Roles and Features Wizard, demonstrating a Remote Desktop Services installation." height="355" src="kA04u0000000HZBCA2_e47c0535-200b-42a6-8f95-97560b6faab6.png" width="500"/><br/><br/>Select <b>Session-based desktop deployment</b>, and click <b>Next</b>.<br/><br/><img alt="Screenshot of Windows Server Add Roles and Features Wizard, demonstrating a Remote Desktop Services installation." height="355" src="kA04u0000000HZBCA2_1d0c1a30-a6f2-4025-97df-ec9aacbc3bac.png" width="500"/><br/><br/>Follow the wizard without making any changes until you get to the <b>RD Connection Broker </b>tab. Specify the server intended for the RD Connection Broker server and click <b>Next</b>.<br/><br/><img alt="Screenshot of Windows Server Add Roles and Features Wizard, demonstrating a Remote Desktop Services installation." height="357" src="kA04u0000000HZBCA2_9afaf779-266a-4a17-b1cb-d781b79f4949.png" width="500"/><br/><br/>Specify the server intended for the <b>RD Web Access server</b> and click <b>Next</b>.<br/><br/><img alt="Screenshot of Windows Server Add Roles and Features Wizard, demonstrating a Remote Desktop Services installation." height="359" src="kA04u0000000HZBCA2_062634fc-08a4-4cd0-b672-1781981e4bb3.png" width="500"/><br/><br/>Specify the server intended for the <b>RD Session Host server(s)</b> and click <b>Next</b>.<br/><br/><img alt="Screenshot of Windows Server Add Roles and Features Wizard, demonstrating a Remote Desktop Services installation." height="355" src="kA04u0000000HZBCA2_b4cab638-d109-4b63-b66b-1ddf7dbd5911.png" width="500"/><br/><br/>Review RDS role server selection, check the <b>Restart the destination server automatically if required</b> box, and click <b>Deploy</b>.<br/><br/><img alt="Screenshot of Windows Server Add Roles and Features Wizard, demonstrating a Remote Desktop Services installation." height="353" src="kA04u0000000HZBCA2_cc9aa4fd-f1d0-4fe6-adee-40caa5e1bc5b.png" width="500"/><br/><br/>The RD role services installation begins, and about halfway through the server will automatically reboot. Once the server has rebooted, log-in with the same account used when the installation was first started, open <b>Server Manager</b>, and the installation dialogue window will resume.<br/><br/>Following completion of RDS role services installation, launch <b>Server Manager</b> and navigate to the RDS overview window, click on <b>3 Create session collections</b>.<br/><br/><img alt="Screenshot of Windows Server Manager's Remote Desktop Services overview user interface." height="131" src="kA04u0000000HZBCA2_0725ae5c-6e2d-49de-af1d-57aef8ca004b.png" width="500"/><br/><br/>Follow the wizard until you get to the <b>Collection Name</b> tab. Enter a name, such as "NPS Applications", and click <b>Next</b>.<br/><br/><img alt="Screenshot of Windows Remote Desktop Service's Create Collection wizard." height="366" src="kA04u0000000HZBCA2_d22331a4-453b-4c2b-98ae-1ff8ebe7dd5a.png" width="500"/><br/><br/>Specify the RD Session Host server (specified earlier during installation of the RD Session Host server role) and click <b>Next</b>.<br/><br/>Add the user groups who will access RemoteApps in the session collection. Click <b>Next</b>.<br/><br/><img alt="Screenshot of Windows Remote Desktop Service's Create Collection wizard." height="368" src="kA04u0000000HZBCA2_dbeed88a-9e6b-4b06-a96f-1476ddf797b1.png" width="500"/><br/><br/>Optionally specify and enable user profile disks (not used in test environment to create this configuration guide). Review the defined session collection parameters and click <b>Create</b>. Once the session collection is created, you can close the <b>Create Collection</b> wizard.<br/><br/>In <b>Server Manager</b> navigate to the <b>Remote Desktop Services Overview</b> and note new session collection created under the RD Session Host icon.<br/><br/><img alt="Screenshot of Windows Remote Desktop Services Overview in Server Manager, demonstrating an added RD Session Host." height="358" src="kA04u0000000HZBCA2_c899973a-9363-42a7-b3ed-50149792eac7.png" width="500"/><br/><br/>RemoteApps are published by navigating to the <b>Collections</b> tab of <b>Server Manager</b> and selecting <b>Publish RemoteApp Programs</b> from the <b>Task </b>menu.<br/><br/><img alt="Screenshot demonstrating Publish RemoteApp Programs in a Windows Remote Desktop Services Session Collection." height="248" src="kA04u0000000HZBCA2_4516cf98-ea13-4c9e-80fe-3a3452233a72.png" width="500"/><br/><br/>If the required application is listed, select it. For applications such as ADUC (in this example) you will need to specify the executable name and path. Click <b>Add</b>.<br/><br/><img alt="Screenshot of the Publish RemoteApp Program wizard for Windows Remote Desktop Services, demonstrating how to add a RemoteApp to the list of programs." height="366" src="kA04u0000000HZBCA2_d97d906d-7f31-4af1-9210-b5be9ac9f0c0.png" width="500"/><br/><br/>For ADUC, in this step we will add <b>MMC (\\&lt;rds_server&gt;\c$\Windows\System32\mmc.exe)</b>.<br/><br/><img alt="Screenshot of Windows Explorer, being used to add mmc.exe as a RemoteApp Program for Windows Remote Desktop Services." height="293" src="kA04u0000000HZBCA2_bba1cce8-b6f5-40a9-a3a2-dfb1ea8cd7ee.png" width="500"/><br/><br/>After adding all desired programs, click <b>Next</b>, click <b>Publish</b>, and then click <b>Close</b>.<br/><br/>In this next step, rename the RemoteApp and specify a parameter to launch ADUC. For additional security, it is possible to assign groups of users to RemoteApps. For example, you can assign the ADUC RemoteApp to an AD group called “RAUsers_ADUC”.<br/><br/>Right click the <b>RemoteApp </b>and select <b>Edit Properties</b>.<br/><br/><img alt="Screenshot of editing the Properties of a published RemoteApp in Windows Remote Desktop Services." height="235" src="kA04u0000000HZBCA2_5dbe4726-b9dc-4eb4-b07f-d74c66989a75.png" width="500"/><br/><br/>Edit the RemoteApp name and set it to "ADUC", then click the <b>Parameters</b> tab in the left sidebar.<br/><br/><img alt="Screenshot of editing the name of a published RemoteApp in Windows Remote Desktop Services." height="402" src="kA04u0000000HZBCA2_14312353-de94-4fc7-ad25-5d7713f0d52f.png" width="500"/><br/><br/>On the <b>Parameters</b> tab, select the <b>Always use the following command-line parameters</b> radio button. For the path use: <b>dsa.msc</b><br/><br/>Click on the <b>User Assignment</b> tab in the left sidebar. Select the user access control group for the RemoteApp. In this case, specifying that users must be a member of the <b>RAUsers_ADUC</b> group to run the ADUC RemoteApp.<br/><br/><img alt="Screenshot of defining which Active Directory group(s) can access a published RemoteApp in Windows Remote Desktop Services." height="402" src="kA04u0000000HZBCA2_2ee9741d-c67d-47d0-af2f-5f21332a67b6.png" width="500"/><br/><br/>Click <b>OK</b>. Configuration of ADUC as a RemoteApp that can be accessed via a Privilege Secure activity is now complete. Next, there is necessary setup in a Privilege Secure activity.<br/><br/>Log-in to NPS as an Administrator. You will create an activity to execute the ADUC RemoteApp created earlier. Ensure <b>Interactive App Launch</b> is selected and the full application path to the RemoteApp on the RDS host is specified – but don't use the full path for MMC extensions such as <b>dsa.msc</b>.<br/><br/>For example: <b>C:\Windows\System32\mmc.exe dsa.msc</b><br/><br/><span><i><b>IMPORTANT:</b> Double check that the Application to Launch field exactly matches the application and parameter you published with the RemoteApp. Note that for the application value you should always use implicit drive/folder names i.e. use C:\Windows\ and NOT relative identifiers such as %SYSTEMROOT%.</i></span><br/><br/><img alt="User-added image" height="242" src="kA04u0000000HZBCA2_025765a5-38a6-4090-8d43-7ef20df19b57.png" width="500"/><br/><br/>For this example, add the Login Account to the <b>RAUsers_ADUC</b> domain group specified for the RemoteApp by adding an <b>Add User to Domain Group</b> action to the activity's pre-session.<br/><br/><img alt="Screenshot of adding a Add User to Domain Group action step for Active Directory group RAUsers_ADUC to an SbPAM activity's pre-session." height="481" src="kA04u0000000HZBCA2_f49bfeca-73e8-4726-a0c9-6b0c93a006aa.png" width="500"/><br/><br/>For temporary privilege elevation, you may also want to add a step to add the Login Account to <b>Domain Admins</b>.<br/><br/>Create an access policy in Privilege Secure that contains the recently created activity, the users who should have access to use it, and the Remote Desktop Services server resource. You can now provision this activity as any user granted privilege to use it.<br/><br/>When you connect to the Remote Desktop Services server, notice you only have access to the published RemoteApp (in this case, ADUC). The RDP session does not offer a full desktop environment, since this is just an Interactive App Launch for a specified program.<br/><br/><img alt="Screenshot of an SbPAM Interactive App Launch demonstrating an RDP session that opened the ADUC program on the target Remote Desktop Services server." height="385" src="kA04u0000000HZBCA2_20054f81-b0ee-4b3d-8284-22d209e66bc1.png" width="500"/></p></div>
</article></body></html>