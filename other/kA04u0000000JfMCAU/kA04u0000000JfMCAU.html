<?xml version="1.0" encoding="UTF-8"?><html><head><meta charset="utf-8"/><title>Mongo Commands - Certain Change Tracker Agents Spike RAM When Connected after a report has run repeatedly (for example, being set to 0, no repeat)</title><meta name="label" content="skb"/><meta name="label" content="employees_v"/><meta name="KnowledgeArticleId" content="kA04u0000000JfMCAU"/><meta name="Id" content="ka04u000000HdB7AAK"/><meta name="LastPublishedDate" content="2022-02-07T01:00:37.000+0000"/><meta name="LastModifiedDate" content="2023-05-08T10:18:16.000+0000"/><meta name="FirstPublishedDate" content="2022-02-07T01:00:37.000+0000"/><meta name="Language" content="en_US"/><meta name="UrlName" content="8308"/><meta name="ArticleNumber" content="000008308"/><meta name="description" content="HELPDESK"/></head><body><article class=" kb-articles"><div class="Content__c"><p>If Change Tracker Agents are consuming a lot of RAM on the IIS Server after a report has gone haywire from being set to 0, no repeat and has created thousands of copies, the below commands can be used to clear up the Agent's report requests</p><p><br/></p><p><strong>To Validate How Many Reports the Agent is Waiting to Run or has Completed:</strong></p><p><br/></p><p>On the Change Tracker server and in the installation directory of the Mongo DB, C:\Program Files\NNT Change Tracker Suite\Gen7\MongoDB\bin by default, there is a mongo shell executable, mongo.exe.</p><p>Open a command prompt with admin privileges and change directory to the location of mongo.exe.<br/>run the following commands:</p><div class="code-block"><div class="code panel pdl conf-macro output-block"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre">&gt; mongo.exe
&gt; use NNTHubService</pre>
</div></div></div><p>This will log you in and move you to the NNT Change Tracker database. Now run the following command and note the results. Note that you must change the "AgentTask.AgentDevice.AgentId" and "AgentTask.AgentDevice.DeviceId" to match the ID numbers of the problem agents. You must also specify the report in question "AgentTask.PolicyTemplateName".Â </p><div class="code-block right-shadow"><div class="code panel pdl conf-macro output-block"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre">&gt; db.AgentTasks.find({$and: [{"AgentTask.AgentTaskType":5},{"AgentTask.PolicyTemplateName":"Wescom Server 2016 Phase 1 v1 CIS v1.0.0 - Level 1 Member Server"},{"AgentTask.AgentDevice.AgentId" : "927" },{"AgentTask.AgentDevice.DeviceId" : "927" }]}).count();</pre>
</div></div></div><p class="auto-cursor-target">The example below can be used if you do not want to specify any report, and just want to know the total number:</p><div class="code panel pdl conf-macro output-block"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre">&gt; db.AgentTasks.find({$and: [{"AgentTask.AgentTaskType":5},{"AgentTask.AgentDevice.AgentId" : "927" },{"AgentTask.AgentDevice.DeviceId" : "927" }]}).count();</pre>
</div></div><p class="auto-cursor-target"><strong>To Clear Reports the Agent is Waiting to Run or Has Completed:</strong></p><p>The following procedure should be followed to clear the results:</p><p><br/></p><p><strong>1. Stop the agent service on the problem systems</strong></p><p><strong>2. Delete the agent rebuild-able files on the system (reset the agent)</strong></p><p><br/></p><p>Then, On the Change Tracker server and in the installation directory of the Mongo DB, C:\Program Files\NNT Change Tracker Suite\Gen7\MongoDB\bin by default, there is a mongo shell executable, mongo.exe.</p><p>Open a command prompt with admin privileges and change directory to the location of mongo.exe.<br/>run the following commands:</p><div class="code panel pdl conf-macro output-block"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre">&gt; mongo.exe
&gt; use NNTHubService</pre>
</div></div><p>This will log you in and move you to the NNT Change Tracker database. Now run the following command to remove the queued reports for a specific agent / report combination:</p><div class="code-block"><div class="code panel pdl conf-macro output-block"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre">&gt; db.AgentTasks.remove({$and: [{"AgentTask.AgentTaskType":5},{"AgentTask.PolicyTemplateName":"Wescom Server 2016 Phase 1 v1 CIS v1.0.0 - Level 1 Member Server"},{"AgentTask.AgentDevice.AgentId" : "927" },{"AgentTask.AgentDevice.DeviceId" : "927" }]});</pre>
</div></div></div><p class="auto-cursor-target">To remove all results for a specific agent, the below can be used instead of the above:</p><div class="code panel pdl conf-macro output-block"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre">&gt; db.AgentTasks.remove({$and: [{"AgentTask.AgentTaskType":5},{"AgentTask.AgentDevice.AgentId" : "927" },{"AgentTask.AgentDevice.DeviceId" : "927" }]});</pre>
</div></div><p><br/></p><p>Once this is complete for all problem agents, proceed with the following:</p><p><br/></p><p><strong>4. Start the agent service</strong></p><p><strong>5. Do an IIS Reset for good measure.</strong></p><p><br/></p><p>Does the RAM still spike after the IIS reset with the agent running? If not, repeat this process on the other problem machines one by one.</p><p><br/></p></div>
</article></body></html>