<?xml version="1.0" encoding="UTF-8"?><html><head><meta charset="utf-8"/><title>Run Time Estimation</title><meta name="label" content="employees_v"/><meta name="label" content="skb"/><meta name="KnowledgeArticleId" content="kA04u0000000IxxCAE"/><meta name="Id" content="ka04u000000HczRAAS"/><meta name="LastPublishedDate" content="2022-02-01T18:44:43.000+0000"/><meta name="LastModifiedDate" content="2023-05-08T10:12:56.000+0000"/><meta name="FirstPublishedDate" content="2022-02-01T18:44:43.000+0000"/><meta name="Language" content="en_US"/><meta name="UrlName" content="7375"/><meta name="ArticleNumber" content="000007375"/><meta name="description" content="360008408371"/></head><body><article class=" kb-articles"><div class="Content__c"><p><strong><span class="wysiwyg-font-size-large">Summary:</span></strong> Given a JobName, this will estimate the time that a particular job will finish, based on the assumption that each host will take approximately the same amount of time to process.</p><p><strong><span class="wysiwyg-font-size-large">Issue:</span></strong> I recently ran into a situation where the Bulk Import job was taking much longer than normal to complete, and had to come up with an estimate for when it will actually complete, given current progress. Step in the JobTaskStats table.<br/> <br/>Given a JobName, this will estimate the time that a particular job will finish, based on the assumption that each host will take approximately the same amount of time to process.<br/> </p><p><strong><span class="wysiwyg-font-size-large">Instructions:</span></strong>  <br/><span><span><span>/*-------------------------------------------------------------------</span></span></span><br/><span><span><span>Copyright (C) 2017 STEALTHbits Technologies, Inc.</span></span></span><br/><span><span><span>Written by:          Kyle Enman</span></span></span><br/><span><span><span>Date:                7/5/2017</span></span></span><br/><span><span><span>Purpose:             Estimates Job Completion</span></span></span><br/> <br/><span><span><span>Revision History: When/Who/What (most recent at top)</span></span></span><br/><span><span><span>      2017/07/24 / Kyle Enman / Simplified by using variables and updated to exclude pre-processing (time between JRTK and MIN(StartTime) of first job task) time in estimate.</span></span></span><br/><span><span><span>---------------------------------------------------------------------*/</span></span></span><br/> <br/><span><span><span>IF</span></span></span><span><span> <span>OBJECT_ID</span><span>(</span><span>'SA_JobEstimator_Result'</span><span>,</span> <span>'u'</span><span>)</span> <span>IS</span> <span>NOT</span> <span>NULL</span></span></span><br/><span><span><span>DROP</span></span></span><span><span> <span>TABLE</span> SA_JobEstimator_Result</span></span><br/> <br/><span><span><span>declare</span></span></span><span><span> @JobName <span>varchar</span><span>(</span>64<span>)</span></span></span><br/><span><span><span>declare</span></span></span><span><span> @JobRunTimeKey <span>smalldatetime</span></span></span><br/><span><span><span>declare</span></span></span><span><span> @JobProcessStart <span>smalldatetime</span></span></span><br/><span><span><span>declare</span></span></span><span><span> @HostsTargeted <span>int</span></span></span><br/><span><span><span>declare</span></span></span><span><span> @HostsProcessed <span>int</span></span></span><br/><span><span><span>set</span></span></span><span><span> @JobName<span>=</span><span>'2-FSAA Bulk Import'</span></span></span><br/><span><span><span>set</span></span></span><span><span> @JobRunTimeKey<span>=(</span><span>select</span> <span>MAX</span><span>(</span>JobRunTimeKey<span>)</span> <span>from</span> SA_JobStatsTbl <span>WHERE</span> JobName<span>=</span>@JobName<span>)</span></span></span><br/><span><span><span>set</span></span></span><span><span> @JobProcessStart<span>=(</span><span>select</span> <span>MIN</span><span>(</span>StartTime<span>)</span> <span>from</span> SA_JobTaskStatsTbl <span>WHERE</span> JobName<span>=</span>@JobName <span>and</span> JobRunTimeKey<span>=</span>@JobRunTimeKey<span>)</span></span></span><br/><span><span><span>set</span></span></span><span><span> @HostsTargeted<span>=(</span><span>select</span> <span>COUNT</span><span>(*)</span> <span>from</span> SA_JobTaskStatsTbl <span>WHERE</span> JobName<span>=</span>@JobName <span>AND</span> JobRunTimeKey<span>=</span>@JobRunTimeKey <span>AND</span> TaskType<span>=</span><span>'Query'</span><span>)</span></span></span><br/><span><span><span>set</span></span></span><span><span> @HostsProcessed<span>=(</span><span>select</span> <span>COUNT</span><span>(*)</span> <span>from</span> SA_JobTaskStatsTbl <span>WHERE </span><span>(</span>JobName<span>=</span>@JobName<span>)</span> <span>AND</span> JobRunTimeKey<span>=</span>@JobRunTimeKey <span>AND</span> <span>Status</span> <span>not</span> <span>in</span> <span>(</span><span>'Queued'</span><span>,</span> <span>'Running'</span><span>))</span></span></span><br/><span><span><span>select</span></span></span><span><span> <span>CAST</span><span>(</span><span>getdate</span><span>()</span> <span>as</span> <span>datetime</span><span>)</span> <span>as</span> CurrentTime</span></span><br/><span><span><span>,</span></span></span><span><span>     @JobName <span>as</span> JobName</span></span><br/><span><span><span>,</span></span></span><span><span>     @JobRunTimeKey <span>as</span> JobStart</span></span><br/><span><span><span>,</span></span></span><span><span>     @JobProcessStart <span>as</span> JobProcessingStarted</span></span><br/><span><span><span>,</span></span></span><span><span>     @HostsTargeted <span>as</span> HostsTargeted</span></span><br/><span><span><span>,</span></span></span><span><span>     @HostsProcessed <span>as</span> HostsProcessed</span></span><br/><span><span><span>,</span></span></span><span><span>     <span>dateadd</span><span>(</span><span>second</span><span>,((</span>1.0<span>*</span><span>DATEDIFF</span><span>(</span><span>second</span><span>,</span>@JobProcessStart<span>,</span><span>ISNULL</span><span>((</span><span>SELECT</span> EndTime <span>FROM</span> SA_JobStatsTbl <span>WHERE</span> JobName<span>=</span>@JobName <span>AND</span> JobRunTimeKey<span>=</span>@JobRunTimeKey<span>),</span><span>getdate</span><span>())))/</span></span></span><br/><span><span><span>(</span></span></span><span><span><span>select</span></span></span><span><span> <a href="mailto:1.0*@HostsProcessed/(1.0*@HostsTargeted))),@JobProcessStart)" target="_blank">1.0*@HostsProcessed/(1.0*@HostsTargeted))),@JobProcessStart)</a> <span>AS</span> ExpectedFinish</span></span><br/><span><span><span>INTO</span></span></span><span><span> SA_JobEstimator_Result</span></span><br/> </p><p><strong><span class="wysiwyg-font-size-large">Product:</span></strong> StealthAUDIT<br/><strong><span class="wysiwyg-font-size-large">Module:</span></strong> SA - Core<br/><strong><span class="wysiwyg-font-size-large">Legacy Article ID:</span></strong> 1648<br/></p></div>
</article></body></html>