<?xml version="1.0" encoding="UTF-8"?><html><head><meta charset="utf-8"/><title>Powershell - Get Mapped Drives</title><meta name="label" content="employees_v"/><meta name="label" content="skb"/><meta name="KnowledgeArticleId" content="kA04u0000000IQFCA2"/><meta name="Id" content="ka04u000000HcmmAAC"/><meta name="LastPublishedDate" content="2022-02-01T18:20:16.000+0000"/><meta name="LastModifiedDate" content="2023-05-08T10:06:48.000+0000"/><meta name="FirstPublishedDate" content="2022-02-01T18:20:16.000+0000"/><meta name="Language" content="en_US"/><meta name="UrlName" content="6544"/><meta name="ArticleNumber" content="000006544"/><meta name="description" content="360008408371"/></head><body><article class=" kb-articles"><div class="Content__c"><p><strong><span class="wysiwyg-font-size-large">Summary:</span></strong> PowerShell Syntax to get Mapped Drives</p>
<p><strong><span class="wysiwyg-font-size-large">Issue:</span></strong> PowerShell Syntax to get Mapped Drives</p>
<p><strong><span class="wysiwyg-font-size-large">Instructions:</span></strong> <span><span>Not sure why, but sometimes space information isn't returned. But here it is anyway.</span></span></p>
<pre>#$JobCredential=Get-Credential<br/>#$TgtHost='SBNJDEV07'<br/>$TgtHost = '[SAHOSTNAME]'<br/> <br/>if ($TgtHost -eq $env:ComputerName -or $TgtHost -eq 'localhost') {<br/>    $Drives = Get-WmiObject win32_mappedlogicaldisk -ComputerName $TgtHost<br/>    $Sessions = Get-WmiObject win32_loggedonuser -ComputerName $TgtHost | Select-Object Antecedent, Dependent<br/>}<br/>else {<br/>    $Drives = Get-WmiObject win32_mappedlogicaldisk -ComputerName $TgtHost -Credential $JobCredential<br/>    $Sessions = Get-WmiObject win32_loggedonuser -ComputerName $TgtHost -Credential $JobCredential | Select-Object Antecedent, Dependent<br/>}<br/>$AllDrives = @()<br/>foreach ($Drive in $Drives) {<br/>$Drive<br/>    foreach ($Session in $Sessions) {<br/>        $Obj = '' | Select-Object DeviceID, Caption, Name, VolumeName, FileSystem, ProviderName, DriveSessionID, SessionID, UserDomain, UserName, FreeSpaceGB, SizeGB, PercentFreeSpace<br/>        [long]$SessionID = $session.Dependent[($session.Dependent.indexof(''')+1)..($session.Dependent.lastindexof(''') - 1)] -join ('')<br/>        $Domain = $session.Antecedent[($session.Antecedent.indexof('Domain='')+8)..($session.Antecedent.indexof('',') - 1)] -join ('')<br/>        $UserName = $session.Antecedent[($session.Antecedent.indexof('Name='')+6)..($session.Antecedent.lastindexof(''') - 1)] -join ('')<br/>        $Obj.DeviceID = $Drive.DeviceID<br/>        $Obj.Caption = $Drive.Caption<br/>        $Obj.Name = $Drive.Name<br/>        $Obj.VolumeName = $Drive.VolumeName<br/>        $Obj.FileSystem = $Drive.FileSystem<br/>        $Obj.ProviderName = $Drive.ProviderName<br/>        [long]$Obj.DriveSessionID = $Drive.SessionID<br/>        [long]$Obj.SessionID = $SessionID<br/>        $Obj.UserDomain = $Domain<br/>        $Obj.UserName = $UserName<br/>        if ($Null -ne $Drive.Size) {<br/>            [long]$Obj.FreeSpaceGB = [MATH]::Round($Drive.FreeSpace/1GB, 2)<br/>            [long]$Obj.SizeGB = [MATH]::Round($Drive.Size/1GB, 2)<br/>            [long]$Obj.PercentFreeSpace = [MATH]::Round(100*$Drive.FreeSpace/$Drive.Size, 2)<br/>        }<br/>        else {<br/>            [long]$Obj.FreeSpaceGB = $null<br/>            [long]$Obj.SizeGB = $null<br/>            [long]$Obj.PercentFreeSpace = $null<br/>        }<br/>        $AllDrives += $Obj<br/>    }<br/>}<br/>$TrueDrives = $AllDrives | Where-Object { $_.SessionID -eq $_.DriveSessionID }<br/>$TrueDrives </pre>
<p><strong><span class="wysiwyg-font-size-large">Module:</span></strong> SA - DC - PowerShell<br/><strong><span class="wysiwyg-font-size-large">Salesforce Article ID:</span></strong> 000001084</p></div>
</article></body></html>