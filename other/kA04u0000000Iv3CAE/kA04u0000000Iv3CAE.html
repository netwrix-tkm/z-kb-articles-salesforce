<?xml version="1.0" encoding="UTF-8"?><html><head><meta charset="utf-8"/><title>FSAA Scan Modes and Log Locations</title><meta name="label" content="employees_v"/><meta name="label" content="skb"/><meta name="KnowledgeArticleId" content="kA04u0000000Iv3CAE"/><meta name="Id" content="ka04u0000001DVuAAM"/><meta name="LastPublishedDate" content="2022-02-01T18:41:34.000+0000"/><meta name="LastModifiedDate" content="2022-02-01T18:41:34.000+0000"/><meta name="FirstPublishedDate" content="2022-02-01T18:41:34.000+0000"/><meta name="Language" content="en_US"/><meta name="UrlName" content="FSAAScanModesandLogLocations61f97edd500d1"/><meta name="ArticleNumber" content="000007320"/><meta name="description" content="360008408371"/></head><body><article class=" kb-articles"><div class="Content__c"><p><strong><span class="wysiwyg-font-size-large">Summary:</span></strong> Where FSAA keeps tier 2 databases and logs for each of the scan modes.</p>
<p><strong><span class="wysiwyg-font-size-large">Issue:</span></strong> There are several different scan modes that the FSAA data collector can leverage.<br/><br/>The location of the tier 2 databases and applet logs will vary, depending on that mode.<br/><br/>This article assumes that StealthAUDIT was installed to a path ending in \StealthAUDIT\.<br/>Otherwise, the FSAA folder would actually be located in \StealthAUDIT\FSAA in the parent folder of the installation directory.</p>
<p><strong><span class="wysiwyg-font-size-large">Instructions:</span></strong></p>
<div>
<strong><span>Local Mode</span></strong><br/><span><span><span>(An active network connection is used to stream the data between the target)</span></span></span><br/><span>Tier 2s are built locally on the StealthAUDIT console while the scan is running.  </span><br/><span>Applet logs are stored on the StealthAUDIT console's FSAA folder</span><br/><span>%sainstalldir%FSAA        (if using the default installation directory: C:\Program Files (x86)\STEALTHbits\StealthAUDIT\FSAA)</span><br/> </div>
<p><strong><span>Applet Mode</span></strong><br/><span>(An applet is deployed to the target and the scan runs on the target instead of streaming data over the network.)</span><br/><span>Tier 2 databases are sent to the <strong>target </strong>server, if they exist on the StealthAUDIT console, otherwise, they are built on the target host.  (See bottom of article for more detail.)<br/>In either case, they are then zipped and copied back to the StealthAUDIT console's FSAA folder when the scan is finished.  </span><br/><br/><span>Applet logs are stored in the FSAA folder on the <strong>target </strong>host: <br/>It tries to read "HKLM\ SYSTEM\CurrentControlSet\Control\Session Manager\Environment\SAInstallDIr" registry first<br/>if that doesn't exist then default path is C:\Program Files (x86)\STEALTHbits\StealthAUDIT\FSAA</span><br/><br/><strong><span>Proxy Mode</span></strong><br/><span>(Scans are performed from a remote proxy server to help distribute resources and localize scans geographically to improve performance for large deployments and slow links.)</span><br/><span>Tier 2 databases are sent to the <strong>proxy </strong>server, if they exist on the StealthAUDIT console, otherwise, they are built on the proxy.  (See bottom of article for more detail.)<br/>In either case, they are then zipped and copied back to the StealthAUDIT console's FSAA folder when the scan is finished.  </span><br/><br/><span>Applet logs are stored in the FSAA folder on the <strong>proxy </strong>host: <br/>It tries to read "HKLM\ SYSTEM\CurrentControlSet\Control\Session Manager\Environment\SAInstallDIr" registry first<br/>f that doesn't exist then default path is C:\Program Files (x86)\STEALTHbits\StealthAUDIT\FSAA</span><br/><br/><span>Proxy mode can work one of two ways:</span></p>
<ol><li>     <span>Standard Proxy mode:  an applet is sent from StealthAUDIT to the proxy server and started through a remote scheduled task.  </span>
</li><li>     <span>FSAA as a service: FSAA is installed on the proxy server and constantly runs as a service instead of an applet <br/></span><span>The up to date FSAA proxy installed is available for each supported StealthAUDIT version from our website.<br/>Log in to <a href="http://www.stealthbits.com" target="_blank">www.stealthbits.com</a> and navigate to "Product downloads"</span>
</li></ol>
<p><span>https://www.stealthbits.com/product-downloads</span></p>
<p><span><span><span>In either of these modes, FSAA uses a local mode style connection between the proxy and the target, meaning an active network connection is used to stream the data between the target and the proxy instead of an applet being deployed to the target.  </span></span></span><br/> <br/><span><span><span>Conditions for sending tier2 from SA console to Proxy/Target server in 7.1+ FSAA</span></span></span><br/><span><span><span>FSAADC collects GUID, USN and  ScanCompleted value from TBL_FSAA_Sequence table from Proxy or Target server(let's call it RemoteGUID, RemoteUSN and RemoteScanCompleted) and collects GUID, USN and ScanCompleted value from TBL_FSAA_Sequence table from local SA console(LocalGUID, LocalUSN and LocalScanCompleted).</span></span></span><br/> <br/><span>1.</span>       <span>RemoteGUID is blank or</span><br/><span>2.</span>       <span>RemoteGUID is not equal to LocalGUID or</span><br/><span>3.</span>       <span>RemoteUSN is not equal to LocalUSN or</span><br/><span>4.</span>       <span>RemoteScan is not completed <strong>and </strong>Local Tier 2 is newer than Remote Tier 2 (based on TBL_FSAA_Status.ScanTime)<br/>5.</span>       Remote Tier 2s have the correct user version<br/> <br/><span><span><span>If one of the above condition is true then DCFSAA sends the Tier 2s from SA to the Proxy or Target server.</span></span></span><br/> <br/><span><span><span>FSAA applet unzips the Tier 2s on Proxy/Target server and replace local tier2, which is on Proxy or Target, with File from zip only if file from zip is newer than local file.</span></span></span><br/> <br/><span><span><span>How FSAA Determines if it should run a scan</span></span></span><br/><span><span><span>FSAA first checks:</span></span></span></p>
<div><span><span><span>No Tier 2s exist<br/>previous scan wasn't completed<br/>Tier 2s are older than the value for "Restart Incomplete Scan After..." (or if it's set to 0)</span></span></span></div>
<p><br/><span><span><span>If <strong>none </strong>of the above conditions are met, it will start a new scan, unless one of the following conditions are met: </span></span></span></p>
<div><span><span><span>Host is not present in SA_FSAA_Hosts, meaning that host has never had a bulk import<br/>Tier 1's GUID no longer matches Tier 2's GUID (meaning Tier 1 and 2 have different data.  they need to match.  more detail on this below)<br/>Tier 2's USN is &gt; Tier 1's USN, meaning there is data for bulk import (this only applies to activity or sensitive data?)</span></span></span></div>
<p><br/><span><span><span>Tier 1 vs. Tier 2 GUID Mismatch</span></span></span><br/><span><span><span>Tier 1 and 2 need to match because FSAA uses numbers to identify objects, such as folders or users.  <br/>If the tier 1 and 2 GUIDs don't match, we can't know that those numbers represent the same object from tier 1 to tier 2, making the scan data invalid.  <br/><br/>If there is only permission information in Tier 1 for that host, and FSAA detects a GUID mismatch, it will automatically clear Tier 1 for that host, and import the new Tier 2 data.  <br/>If there is activity data, it will throw an error telling the user to contact support, preventing any further action.  <br/>(this shouldn't happen, but it does, and we need to do our best to identify why and prevent it going forward.  <br/>the only solution to this is to </span></span></span></p>
<div>
<span><span><span>1) back up the customer's data, either by a full db backup or select * into ActivityBackupTable from SA_FSAC_ActivityEventsView <br/>2) drop the existing data for that host (7.2 and newer has a query category in the FSAA for this)<br/>3) remove Tier 2s from SA Console, Proxy, and Target (where applicable) <br/>4) re-scan</span></span></span> </div>
<div>
<br/><span><span><span>Moving the location of the FSAA folder on proxy or target servers</span></span></span>
</div>
<div>
<span>1) Move your FSAA folder on the target machine to where you want it located.  It must be within a folder named StealthAUDIT.  </span><br/><span>2) Update the SAINSTALLDIR environment variable on the target machine to point to your new StealthAUDIT folder from above.  </span>
</div>
<div>
<span>The default for this path is </span><span>C:\Program Files (x86)\STEALTHbits\StealthAUDIT\<br/>The data collector references %SAInstallDir%\..\StealthAUDIT\FSAA<br/>That means that it will remove the last folder from the %sainstalldir% path, and will add the StealthAUDIT\FSAA<br/>(eg. If your %sainstalldir% is set to D:\temp, your FSAA Tier 2s will be stored in D:\StealthAUDIT\FSAA.)</span>
</div>
<div>
<img src="kA04u0000000Iv3CAE_a28a5ec5-c49d-4814-8ed8-8b0982454d65.png" alt="mceclip0.png"/><br/> </div>
<div> </div>
<p><strong><span class="wysiwyg-font-size-large">Product:</span></strong> StealthAUDIT<br/><strong><span class="wysiwyg-font-size-large">Module:</span></strong> SA - DC - FSAA - Activity;SA - DC - FSAA - DFS;SA - DC - FSAA - Permissions;SA - DC - FSAA - Sensitive Data<br/><strong><span class="wysiwyg-font-size-large">Legacy Article ID:</span></strong> 1290</p></div>
</article></body></html>