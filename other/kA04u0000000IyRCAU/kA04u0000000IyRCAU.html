<?xml version="1.0" encoding="UTF-8"?><html><head><meta charset="utf-8"/><title>FSAA doesn't mark all children as Deleted.</title><meta name="label" content="employees_v"/><meta name="label" content="skb"/><meta name="KnowledgeArticleId" content="kA04u0000000IyRCAU"/><meta name="Id" content="ka04u000000HczZAAS"/><meta name="LastPublishedDate" content="2022-02-01T18:44:53.000+0000"/><meta name="LastModifiedDate" content="2023-05-08T10:12:58.000+0000"/><meta name="FirstPublishedDate" content="2022-02-01T18:44:53.000+0000"/><meta name="Language" content="en_US"/><meta name="UrlName" content="7382"/><meta name="ArticleNumber" content="000007382"/><meta name="description" content="360008408371"/></head><body><article class=" kb-articles"><div class="Content__c"><p><strong><span class="wysiwyg-font-size-large">Summary:</span></strong> There is a known issue in FSAA where it's possible not all children will be marked as deleted.</p><p><strong><span class="wysiwyg-font-size-large">Issue:</span></strong> There is a known issue in FSAA where it's possible not all children will be marked as deleted.<br/>Following example will reproduce issue:<br/><i><span>Parent folder picked up in permission scan. Child folder was created and picked up during activity scan. Deleted parent and child folder. Subsequent permission scan only marks parent as deleted.</span></i><br/><i><span>The cause is that there are resources in activity that were collected that were not collected by permission scans. </span></i><br/> </p><p><strong><span class="wysiwyg-font-size-large">Instructions:</span></strong> <b>Workaround:</b><br/>The following script can be used to mark children of deleted parents as deleted: 
</p><div>
<span><span><span>IF NOT EXISTS </span></span></span><span><span><span>(</span></span></span><br/><span><span><span>    SELECT </span></span></span><span><span><span>*</span></span></span> <br/><span><span><span>    FROM sys</span></span></span><span><span><span>.</span></span></span><span><span><span>indexes </span></span></span><br/><span><span><span>    WHERE name</span></span></span><span><span><span>=</span></span></span><span><span><span>'SA_FSAA_Resources_DeletedUSN_IDX'</span></span></span><br/><span><span><span>    AND object_id </span></span></span><span><span><span>=</span></span></span><span><span><span> OBJECT_ID</span></span></span><span><span><span>(</span></span></span><span><span><span>'SA_FSAA_Resources'</span></span></span><span><span><span>)</span></span></span><br/>    <span><span><span>)</span></span></span><br/><span><span><span>    CREATE INDEX SA_FSAA_Resources_DeletedUSN_IDX </span></span></span><br/><span><span><span>    ON SA_FSAA_Resources </span></span></span><span><span><span>(</span></span></span><span><span><span>HOST</span></span></span><span><span><span>,</span></span></span> <span><span><span>DeletedUSN</span></span></span><span><span><span>)</span></span></span><br/><span><span><span>    WHERE </span></span></span><span><span><span>DeletedUSN</span></span></span><span><span><span> IS NOT NULL</span></span></span><span><span><span>;</span></span></span><br/><br/><span><span><span>START</span></span></span><span><span><span>:</span></span></span><br/><span><span><span>    UPDATE r</span></span></span><br/><span><span><span>    SET r</span></span></span><span><span><span>.</span></span></span><span><span><span>DeletedUSN</span></span></span> <span><span><span>=</span></span></span><span><span><span> r2</span></span></span><span><span><span>.</span></span></span><span><span><span>DeletedUSN</span></span></span><br/><span><span><span>    FROM SA_FSAA_Resources r</span></span></span><br/><span><span><span>    JOIN SA_FSAA_Resources r2</span></span></span><br/><span><span><span>    ON r</span></span></span><span><span><span>.</span></span></span><span><span><span>ParentResourceID</span></span></span> <span><span><span>=</span></span></span><span><span><span> r2</span></span></span><span><span><span>.</span></span></span><span><span><span>ID</span></span></span><br/><span><span><span>    AND r</span></span></span><span><span><span>.</span></span></span><span><span><span>HOST </span></span></span><span><span><span>=</span></span></span><span><span><span> r2</span></span></span><span><span><span>.</span></span></span><span><span><span>HOST</span></span></span><br/><span><span><span>    WHERE r2</span></span></span><span><span><span>.</span></span></span><span><span><span>DeletedUSN</span></span></span><span><span><span> IS NOT NULL</span></span></span><br/><span><span><span>    AND r</span></span></span><span><span><span>.</span></span></span><span><span><span>DeletedUSN</span></span></span><span><span><span> IS NULL</span></span></span><span><span><span>;</span></span></span><br/><br/><span><span><span>IF </span></span></span><span><span><span>@</span></span></span><span><span><span>@ROWCOUNT</span></span></span> <span><span><span/></span> <span><span><span>0</span></span></span><span><span><span> GOTO START</span></span></span>
</span></div>In the case that those resources are recreated and activity is collected for them, they will remain marked as deleted until an FSAA scan is run again and detects that the resource is no longer deleted. If an FSAA scan doesn't reach that depth, then the resource will remain deleted. In the case that FSAC is run more often than FSAA or FSAA isn't run at full depth (including file-level scans), this can result in activity being hidden from the user because reports will ignore the activity for deleted resources.<br/> <p><strong><span class="wysiwyg-font-size-large">Product:</span></strong> StealthAUDIT<br/><strong><span class="wysiwyg-font-size-large">Module:</span></strong> SA - DC - FSAA - Activity;SA - DC - FSAA - DFS;SA - DC - FSAA - Permissions;SA - DC - FSAA - Sensitive Data<br/><strong><span class="wysiwyg-font-size-large">Versions:</span></strong> 7.1+<br/><strong><span class="wysiwyg-font-size-large">Legacy Article ID:</span></strong> 2025<br/></p></div>
</article></body></html>