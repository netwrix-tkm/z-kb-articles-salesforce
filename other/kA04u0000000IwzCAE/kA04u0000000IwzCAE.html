<?xml version="1.0" encoding="UTF-8"?><html><head><meta charset="utf-8"/><title>SI Signed Agent Not Starting after Server Reboot</title><meta name="label" content="employees_v"/><meta name="label" content="skb"/><meta name="KnowledgeArticleId" content="kA04u0000000IwzCAE"/><meta name="Id" content="ka04u000000Hcz1AAC"/><meta name="LastPublishedDate" content="2022-02-01T18:43:58.000+0000"/><meta name="LastModifiedDate" content="2023-05-08T10:12:49.000+0000"/><meta name="FirstPublishedDate" content="2022-02-01T18:43:58.000+0000"/><meta name="Language" content="en_US"/><meta name="UrlName" content="7360"/><meta name="ArticleNumber" content="000007360"/><meta name="description" content="360008304132"/></head><body><article class=" kb-articles"><div class="Content__c"><p><strong><span class="wysiwyg-font-size-large">Summary:</span></strong> When using signed StealthINTECEPT Agent, upon rebooting the agent service may not start if the certificate validation takes longer than the timeout allowed for services to start. This would cause the agent to be offline.</p>
<p><strong><span class="wysiwyg-font-size-large">Issue:</span></strong> When using a Signed SI Agent, upon reboot Windows will attempt to validate the code signing certificate before allowing the service to start.  It is possible that this certificate validation check could exceed the default timeout for services to start in Windows.  The service would then fail to be started, causing the SI agent to be offline.<br/> <br/>When this situation occurs, the Windows Event Log would show service startup timeout errors prevented the service from starting.  Some possible event IDs that could be seen in this situations are:<br/>7000 "The ServiceName service failed to start due to the following error:  The service did not respond to the start or control request in a timely fashion."<br/>7011 "Timeout (30000 milliseconds) waiting for a transaction response from the ServiceName service."<br/>7009 " A timeout was reached (30000 milliseconds) while waiting for the ServiceName service to connect."<br/> <br/>When this startup timeout occurs, the service can usually be manually started and function properly (probably because the validation check has been done by then), but will likely still continue to fail for the same timeout issue on the next reboot.  Switching the service to delayed start will not resolve the issue, as it only delays when the service attempts to start but does not change the timeout period in which is must start successfully.<br/> </p>
<p><strong><span class="wysiwyg-font-size-large">Instructions:</span></strong> There are two options for resolving this issue:  a global Windows setting change (that would affect all services) or an SI configuration file change<br/> <br/><strong><u>Windows global service parameter setting change method</u></strong><br/>The registry key to control the timeout for ALL services on the machine to start is ServicePipeTimeout in HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control.  If this DWORD value does not exist, you will have to create it.  The time is specified in milliseconds, and the default is 30000 (=30 seconds).   A recommended stating value when increasing is 60000 (=60 seconds).   <em>The machine must be restarted for this setting to take effect!</em><br/>NOTE: <strong>This is the preferred method to address this issue</strong>, as it preserves the certificate checking that occurs with a signed agent.  However, as this is a global setting for the machine, that this change may not be an option for some customers without having to submit a change control request.<br/> <br/>( Reference: <a href="https://support.microsoft.com/en-us/help/922918/a-service-does-not-start-and-events-7000-and-7011-are-logged-in-window" target="_blank"><span>https://support.microsoft.com/en-us/help/922918/a-service-does-not-start-and-events-7000-and-7011-are-logged-in-window</span></a> )<br/> <br/><strong><u>SI configuration file change method</u></strong><br/>NOTE:  This change might be included as the default setting after SI 5.2.  (The change is pending consideration as of the writing of this KB document.)<br/> <br/>An addition to the SI agent configuration file can direct the agent not to take time to generate evidence of authenticity to present to the OS, which can take longer than the timeout allowed when starting the agent service.  (Note that there are security considerations to this change, but in most environments this will be an acceptable tradeoff as the origin of the installer file [STEALTHbits] is known and trusted.)  To configure this, edit the file SI WindowsAgent.exe CONFIG File by adding <strong/> in between <strong> </strong>and <strong/> as shown below. This file is found on the server where the agent is located.  (Example: <strong>C:\Program Files (x86)\STEALTHbits\StealthINTERCEPT\SIWindowsAgent\SIWindowsAgent.exe.config </strong>is the default install location.)<br/> <br/><span><span> </span></span><br/><span><span> </span></span><br/><span><span/></span><br/> <br/>(References: <a href="https://docs.microsoft.com/en-us/dotnet/framework/configure-apps/file-schema/runtime/generatepublisherevidence-element" target="_blank">https://docs.microsoft.com/en-us/dotnet/framework/configure-apps/file-schema/runtime/generatepublisherevidence-element</a> , <a href="https://blogs.msdn.microsoft.com/pfedev/2008/11/25/best-practice-generatepublisherevidence-in-aspnet-config" target="_blank">https://blogs.msdn.microsoft.com/pfedev/2008/11/25/best-practice-generatepublisherevidence-in-aspnet-config</a>  )<br/> </p>
<p><strong><span class="wysiwyg-font-size-large">Product:</span></strong> StealthINTERCEPT<br/><strong><span class="wysiwyg-font-size-large">Module:</span></strong> SI - Windows Agent<br/><strong><span class="wysiwyg-font-size-large">Versions:</span></strong> 5.0.0+<br/><strong><span class="wysiwyg-font-size-large">Dev Ticket:</span></strong> SI-3747<br/><strong><span class="wysiwyg-font-size-large">Legacy Article ID:</span></strong> 2253</p></div>
</article></body></html>