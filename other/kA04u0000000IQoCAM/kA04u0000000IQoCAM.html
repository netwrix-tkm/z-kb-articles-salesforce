<?xml version="1.0" encoding="UTF-8"?><html><head><meta charset="utf-8"/><title>SQL DC Connection Issues</title><meta name="label" content="employees_v"/><meta name="label" content="skb"/><meta name="KnowledgeArticleId" content="kA04u0000000IQoCAM"/><meta name="Id" content="ka04u000000Hcn4AAC"/><meta name="LastPublishedDate" content="2022-02-01T18:20:20.000+0000"/><meta name="LastModifiedDate" content="2023-05-08T10:06:55.000+0000"/><meta name="FirstPublishedDate" content="2022-02-01T18:20:20.000+0000"/><meta name="Language" content="en_US"/><meta name="UrlName" content="6551"/><meta name="ArticleNumber" content="000006551"/><meta name="description" content="360008408371"/></head><body><article class=" kb-articles"><div class="Content__c"><p><strong><span class="wysiwyg-font-size-large">Summary:</span></strong> If you're having trouble collecting data with the SQL data collector, here are some suggestions.</p>
<p><strong><span class="wysiwyg-font-size-large">Issue:</span></strong> The SQL Data Collector throws an error stating that is can not connect to the database.<br/><br/>ODBC Error While Connecting<br/><br/>[Microsoft][ODBC SQL Server Driver][DBNETLIB]SQL Server does not exist or access denied.<br/><br/>[Microsoft][ODBC SQL Server Driver][dbnetlib]ConnectionOpen<br/><br/>(Connect()).<br/><br/>Query was select * from testtable<br/><br/>Check if you are using correct Credentials</p>
<p><strong><span class="wysiwyg-font-size-large">Instructions:</span></strong></p>
<p>1) The hostname, instance name, and port number need to be in a table named SA_SQL_Instances. </p>
<p><br/>There is a "Find Hosts" job in the SQL solution set that will identify any running instances on a target host, and add them to this table for you.  Otherwise, you can just create the table and populate it manually.  <br/><br/>This is the code to create &amp; populate the table manually:</p>
<p><span><span><span>if object_id('SA_SQL_Instances','table') is null</span><br/><span>CREATE TABLE [dbo].[SA_SQL_Instances]([Host] [varchar](128) NOT NULL,[Instance] [varchar](128) NOT NULL,[PortNo] [int] NULL, PRIMARY KEY CLUSTERED </span><br/><span>([Host] ASC,[Instance] ASC) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)) </span><br/><br/><span>INSERT INTO [SA_SQL_Instances] select 'servername','instancename','1433'</span></span></span></p>
<p>2) If you have validated that you are able to make a connection using native Data Sources(ODBC) Windows Application and permissions are correct.  You can look at the following things:</p>
<p>The SQL Server Browser Service is started and enabled (* see below if this can't be enabled)</p>
<p>UDP Port 1434 needs to be allowed for at least the SA Console IP Address</p>
<p>TCP All Ports or the specific Port that is set for the Server\Instance needs to be allowed</p>
<p><br/>* If the SQL Server Brower Service can  not be enabled for security purposes, navigate to the clicnfg.exe (32-bit) version on the StealthAUDIT console and config that SQL Server\Instance\Port Alias</p>
<p>The tool is located here: c:\windows\syswow64\clicnfg.exe (not to be confused with the 64-bit version in c:\windows\system32\clicnfg.exe<br/><br/>3) The TCP Port Rule may need to be set to allow all TCP traffic from the SA Console IP Address for All Ports.  It was only showing 50510 in my Firewall logging.</p>
<p> </p>
<p><strong><span class="wysiwyg-font-size-large">Module:</span></strong> SA - DC - SQL<br/><strong><span class="wysiwyg-font-size-large">Versions:</span></strong> All<br/><strong><span class="wysiwyg-font-size-large">Salesforce Article ID:</span></strong> 000001099</p></div>
</article></body></html>