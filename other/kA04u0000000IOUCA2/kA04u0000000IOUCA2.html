<?xml version="1.0" encoding="UTF-8"?><html><head><meta charset="utf-8"/><title>Script to update XML to use FSAA for control DeletedUSN</title><meta name="label" content="employees_v"/><meta name="label" content="skb"/><meta name="KnowledgeArticleId" content="kA04u0000000IOUCA2"/><meta name="Id" content="ka04u000000Hcm1AAC"/><meta name="LastPublishedDate" content="2022-02-01T18:23:09.000+0000"/><meta name="LastModifiedDate" content="2023-05-08T10:06:20.000+0000"/><meta name="FirstPublishedDate" content="2022-02-01T18:23:09.000+0000"/><meta name="Language" content="en_US"/><meta name="UrlName" content="6598"/><meta name="ArticleNumber" content="000006598"/><meta name="description" content="360008408371"/></head><body><article class=" kb-articles"><div class="Content__c"><p><strong><span class="wysiwyg-font-size-large">Summary:</span></strong> Hotfix for SAFS-806 requires you to update every job XML for every FS scan and bulk import. Depending on the environment this can be very time consuming. Below you will find a PowerShell Script to automate this process.</p>
<p><strong><span class="wysiwyg-font-size-large">Issue:</span></strong> <span><span><strong>Issue:</strong>   </span></span><span><span><span>The hotfixes based on Sb Dev ticket </span>SAFS-806 (listed below) <span>requires that every job XML for every FS scan and bulk import be updated to add the USEFSAAFORDELTED tag.  Depending on the environment, this can be very time consuming. </span><br/><br/><span>8.2_003: <a href="https://na55.salesforce.com/articles/General/Hotfix-SA-8-2-003" target="_blank">https://na55.salesforce.com/articles/General/Hotfix-SA-8-2-003</a></span><br/><span>8.1_109: <a href="https://na55.salesforce.com/articles/General/Hotfix-SA-8-1-109" target="_blank">https://na55.salesforce.com/articles/General/Hotfix-SA-8-1-109</a></span><br/><span>8.0_099: <a href="https://na55.salesforce.com/articles/General/Hotfix-SA-8-0-099" target="_blank">https://na55.salesforce.com/articles/General/Hotfix-SA-8-0-099</a></span><br/><span>7.2 SP1_085: <a href="https://na55.salesforce.com/articles/General/Hotfix-SA-7-2-SP1-085" target="_blank">https://na55.salesforce.com/articles/General/Hotfix-SA-7-2-SP1-085</a></span></span></span></p>
<p><br/><strong><span class="wysiwyg-font-size-large">Instructions:</span></strong> <span><span><strong>Instructions:</strong>  If performing this in StealthAUDIT 8.1 - 9.0 it is recommended to make these changes through the View XML option in the bottom left of Query Properties as this will enable the changes to be recorded and carried over during an upgrade.  The PowerShell script below will make the changes directly to the job XML. Known caveats related to the procedure are below:</span></span></p>
<ul><li><span><span>All changes will be lost during an upgrade, for any jobs based on out-of-the-box jobs.</span></span></li><li><span><span>Jobs with multiple queries are supported, but both queries cannot use FSAA (which should be rare outside a lab environment).</span></span></li><li><span><span>PowerShell needs to be run as administrator.</span></span></li><li><span><span>Any changes made while jobs are running will be overwritten when the job completes.</span></span></li></ul>
<p><span><span><span><span>#gets valid job XMLs, excluding those where the Job value doesn't match the folder name, where the xml is in a group or job path that doesn't start with GROUP_ or JOB_, respectively.<br/>if ($Host.version.Major -gt 2){$emptyArrayValue=0} else {$emptyArrayValue=$null}<br/>$Jobs=$(cmd /c dir /b $("$Env:SAInstallDir"+"Jobs") /s ) | ?{<br/>$(($_[($_.LastIndexOf('\')+1)..$_.length]) -join('') -replace('.xml','')) -eq $(($_[0..($_.LastIndexOf('\')-1)] -join(''))[(($_[0..($_.LastIndexOf('\')-1)] -join('')).lastindexof('\')+1)..($_[0..($_.LastIndexOf('\')-1)] -join('')).length] -join(''))`<br/>-and ($_[($_.LastIndexOf('\')+1)..$_.length]) -join('') -replace('.xml','') -like 'JOB_*' `<br/>-and $($($_[($_.indexof('\StealthAUDIT\Jobs\')+19)..($_.LastIndexOf('\')-1)]) -join('') -split('\\') | ?{$_ -notlike 'JOB_*' -and $_ -notlike 'GROUP_*'}).length -eq $EmptyArrayValue}<br/>$Res=@()<br/>foreach ($JobXML in $Jobs)<br/>{<br/>    $out='' | select 'Date', 'JobXMLPath', 'IsFSAA', 'AddOrUpdate'<br/>    $out.JobXMLPath=$JobXML<br/>    [XML]$Job=get-content $JobXML<br/>    $Out.Date=get-date -format yyyy-MM-dd_HH-mm-ss.fff<br/>    if($Job.Job.Partitions.Partition.Tasks.Task.Settings.Source -eq 'FILESYSTEMACCESS' -and ('scanFileSystemAccessPartial','bulkImportFileSystemAccess','scanFileSystemActivity','bulkImportFileSystemActivity','scanDLP','bulkImportDLP') -contains $Job.Job.Partitions.Partition.Tasks.Task.ROOTS.root.name )<br/>    {#this is an applicable FSAA query (doesn't include maintenance or DFS queries)<br/>       $out.IsFSAA='True'<br/>            if(select-string -path $JobXML -pattern 'False','True')<br/>            {#value exists - make sure it's set to True<br/>                $Out.AddOrUpdate='Update'<br/>                ((get-content $JobXML) -replace('False','True')) | set-content $JobXML<br/>            }<br/>            else<br/>            {#value does not exist - add it at the end of the FSAA Settings node<br/>                $Out.AddOrUpdate='Add'<br/>                ((get-content $JobXML) -replace('','True')) | set-content $JobXML<br/>            }<br/>        <br/>    }<br/>    else<br/>    {<br/>        $Out.IsFSAA='False'<br/>        $Out.AddOrUpdate='N/A'<br/>    }<br/>    $Res+=$Out<br/>}<br/>$Res</span></span></span></span><br/><br/><span><span>Attached is a StealthAUDIT job to execute this.  Set the Host to local host and execute.  If running this in StealthAUDIT 8.1 - 9.0 I would recommend adding this to a Post-Upgrade Job group with FS Migration to run after upgrading.</span></span><br/><br/><a href="https://downloads.stealthbits.com/access/files/StealthTOOLS/AUDIT/JOB_UseFSAADelete.zip" target="_blank">https://downloads.stealthbits.com/access/files/StealthTOOLS/AUDIT/JOB_UseFSAADelete.zip</a></p>
<p><strong><span class="wysiwyg-font-size-large">Product:</span></strong> StealthAUDIT<br/><strong><span class="wysiwyg-font-size-large">Module:</span></strong> SA - DC - FSAA - Permissions<br/><strong><span class="wysiwyg-font-size-large">Versions:</span></strong> 7.2, 8.0, 8.1, 8.2, 9.0<br/><strong><span class="wysiwyg-font-size-large">Dev Ticket:</span></strong> SAFS-806<br/><strong><span class="wysiwyg-font-size-large">Resolved In:</span></strong> Official fix is pending delivery in StealthAUDIT 10.0; the USEFSAAFORDELETE option is only available starting with the following versions: 7.2 SP1: - DCFSAA.dll 7.2.766 - FSAASrv.dll 7.2.766 8.0: - DCFSAA.dll 8.0.852 - FSAASrv.dll 8.0.852 8.1 - DCFSAA.dll 8.1.989 - FSAASrv.dll 8.1.989 8.2 - DCFSAA.dll 8.2.1038 - FSAASrv.dll 8.2.1038 9.0 - GA and later<br/><strong><span class="wysiwyg-font-size-large">Salesforce Article ID:</span></strong> 000002491</p></div>
</article></body></html>