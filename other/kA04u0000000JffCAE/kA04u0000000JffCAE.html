<?xml version="1.0" encoding="UTF-8"?><html><head><meta charset="utf-8"/><title>Mongo Commands - Template Upgrade Process: When Upgrading to R2 7.1.0.18 and Newer</title><meta name="label" content="employees_v"/><meta name="label" content="skb"/><meta name="KnowledgeArticleId" content="kA04u0000000JffCAE"/><meta name="Id" content="ka04u000000HdBBAA0"/><meta name="LastPublishedDate" content="2022-02-07T00:59:55.000+0000"/><meta name="LastModifiedDate" content="2023-05-08T10:18:17.000+0000"/><meta name="FirstPublishedDate" content="2022-02-07T00:59:55.000+0000"/><meta name="Language" content="en_US"/><meta name="UrlName" content="8298"/><meta name="ArticleNumber" content="000008298"/><meta name="description" content="HELPDESK"/></head><body><article class=" kb-articles"><div class="Content__c"><p>-Rationalisation a few of the report template names, so they're now a more consistent set of Detail and Summary (eg 'Device Detail' and 'Device Summary'), but this means a bit of one-off manual mongo work at the point of upgrade from earlier versions - <strong>*** See the bottom of this email for details.</strong></p><p><br/></p><p><strong>Template Upgrade Process</strong></p><p><strong>Note - </strong></p><p><strong>These commands are only relevant when upgrading from Change Tracker R2 <strong>7.1.0.14, <strong>7.1.0.15, </strong></strong>7.1.0.16 and 7.1.0.17. </strong></p><p><strong>it is important to run the mongo update commands before the new R2 7.2.1.18 starts up for the first time after install (i.e. don't forget to stop IIS)</strong></p><p><strong>If you do run the command without IIS being stopped, Change Tracker will survive although any report running at the time might be impacted. Reports will however recover.</strong></p><p><br/></p><p>To rename the templates:</p><ol><li>Stop IIS</li><li>Delete ALL report templates *.json files from <strong>C:\inetpub\wwwroot\Change Tracker Generation 7 Hub\bin\Setup\ReportTemplates</strong></li><li><strong>Install the new version </strong>7.2.1.18</li><li><strong>Run the </strong><strong>script below </strong>to rename the templates in Mongo - note this can be pasted en-masse into the mongo shell. (Take a copy of the full-text result of running each command for later diagnostics)</li><li>Start IIS</li><li>There should be only one template of each 'Report Name' listed in the <strong>second</strong> column of the grid on Settings &gt; Report Layout Templates page</li><li>On the Settings &gt; Report Layout Templates page, there will be various Updated templates available - <strong>Click 'Update Template' on each</strong></li></ol><p><br/></p><p>// Report layout template names have been rationalised in 7.2.1.17</p><p>// Run these queries to update existing records before allowing the 7.2.1.17 IIS application to startup for the first time</p><p>// ====================================================================================================================</p><p><br/></p><p>use NNTHubService</p><p><br/></p><p>// Compliance Full -&gt; Compliance Detail</p><p><br/></p><p>// Find the number of Compliance Full Templates being used.</p><p>db.ReportData.find({'ScheduledReportItem.EmailDelivery.Attachment1TemplateName': 'Compliance Full'}).count()</p><p><br/></p><p>// Update the Template Name</p><p>db.ReportData.update({'ScheduledReportItem.EmailDelivery.Attachment1TemplateName': 'Compliance Full'}, { $set: {'ScheduledReportItem.EmailDelivery.Attachment1TemplateName': 'Compliance Detail'} }, { multi: true })</p><p><br/></p><p>// Find the number of Compliance Detail Templates being used</p><p>db.ReportData.find({'ScheduledReportItem.EmailDelivery.Attachment1TemplateName': 'Compliance Detail'}).count()</p><p><br/></p><p><br/></p><p>// Planned Change Instance -&gt; Planned Change Detail</p><p><br/></p><p>// Find the number of Compliance Full Templates being used.</p><p>db.ReportData.find({'ScheduledReportItem.EmailDelivery.Attachment1TemplateName': 'Planned Change Instance'}).count()</p><p><br/></p><p>// Update the Template Name</p><p>db.ReportData.update({'ScheduledReportItem.EmailDelivery.Attachment1TemplateName': 'Planned Change Instance'}, { $set: {'ScheduledReportItem.EmailDelivery.Attachment1TemplateName': 'Planned Change Detail'} }, { multi: true })</p><p><br/></p><p>// Find the number of Compliance Detail Templates being used</p><p>db.ReportData.find({'ScheduledReportItem.EmailDelivery.Attachment1TemplateName': 'Planned Change Detail'}).count()</p><p><br/></p><p><br/></p><p>// Device Monitoring -&gt; Device Detail</p><p><br/></p><p>// Find the number of Compliance Full Templates being used.</p><p>db.ReportData.find({'ScheduledReportItem.EmailDelivery.Attachment1TemplateName': 'Device Monitoring'}).count()</p><p><br/></p><p>// Update the Template Name</p><p>db.ReportData.update({'ScheduledReportItem.EmailDelivery.Attachment1TemplateName': 'Device Monitoring'}, { $set: {'ScheduledReportItem.EmailDelivery.Attachment1TemplateName': 'Device Detail'} }, { multi: true })</p><p><br/></p><p>// Find the number of Compliance Detail Templates being used</p><p>db.ReportData.find({'ScheduledReportItem.EmailDelivery.Attachment1TemplateName': 'Device Detail'}).count()</p><p><br/></p><p><br/></p><p>// Updating the fs.files Report Template meta data</p><p>// ================================================</p><p><br/></p><p>// Compliance Full -&gt; Compliance Detail</p><p><br/></p><p>// Find the number of Compliance Full Report Templates, filename and metadata counts should match</p><p>db.fs.files.find( { 'filename': 'ComplianceFull.json' }).count()</p><p>db.fs.files.find( { 'metadata.ReportTemplateName': 'Compliance Full' }).count()</p><p><br/></p><p>// Update the filename</p><p>db.fs.files.update({'filename': 'ComplianceFull.json'}, { $set: {'filename': 'ComplianceDetail.json'} }, { multi: true })</p><p>// Update the metadata</p><p>db.fs.files.update({'metadata.ReportTemplateName': 'Compliance Full'}, { $set: {'metadata.ReportTemplateName': 'Compliance Detail'} }, { multi: true })</p><p>db.fs.files.update({'metadata.FileName': 'ComplianceFull.json'}, { $set: {'metadata.FileName': 'ComplianceDetail.json'} }, { multi: true })</p><p><br/></p><p>// Find the number of Compliance Detail Report Templates, filename and metadata counts should match</p><p>db.fs.files.find( { 'filename': 'ComplianceDetail.json' }).count()</p><p>db.fs.files.find( { 'metadata.ReportTemplateName': 'Compliance Detail' }).count()</p><p><br/></p><p><br/></p><p>// Planned Change Instance -&gt; Planned Change Detail</p><p><br/></p><p>// Find the number of Planned Change Instance Report Templates, filename and metadata counts should match</p><p>db.fs.files.find( { 'filename': 'PlannedChangeInstance.json' }).count()</p><p>db.fs.files.find( { 'metadata.ReportTemplateName': 'Planned Change Instance' }).count()</p><p><br/></p><p>// Update the filename</p><p>db.fs.files.update({'filename': 'PlannedChangeInstance.json'}, { $set: {'filename': 'PlannedChangeDetail.json'} }, { multi: true })</p><p>// Update the metadata</p><p>db.fs.files.update({'metadata.ReportTemplateName': 'Planned Change Instance'}, { $set: {'metadata.ReportTemplateName': 'Planned Change Detail'} }, { multi: true })</p><p>db.fs.files.update({'metadata.FileName': 'PlannedChangeInstance.json'}, { $set: {'metadata.FileName': 'PlannedChangeDetail.json'} }, { multi: true })</p><p><br/></p><p>// Find the number of Planned Change Detail Report Templates, filename and metadata counts should match</p><p>db.fs.files.find( { 'filename': 'PlannedChangeDetail.json' }).count()</p><p>db.fs.files.find( { 'metadata.ReportTemplateName': 'Planned Change Detail' }).count()</p><p><br/></p><p><br/></p><p>// Device Monitoring -&gt; Device Detail</p><p><br/></p><p>// Find the number of Device Monitoring Report Templates, filename and metadata counts should match</p><p>db.fs.files.find( { 'filename': 'DeviceMonitoring.json' }).count()</p><p>db.fs.files.find( { 'metadata.ReportTemplateName': 'Device Monitoring' }).count()</p><p><br/></p><p>// Update the filename</p><p>db.fs.files.update({'filename': 'DeviceMonitoring.json'}, { $set: {'filename': 'DeviceDetail.json'} }, { multi: true })</p><p>// Update the metadata</p><p>db.fs.files.update({'metadata.ReportTemplateName': 'Device Monitoring'}, { $set: {'metadata.ReportTemplateName': 'Device Detail'} }, { multi: true })</p><p>db.fs.files.update({'metadata.FileName': 'DeviceMonitoring.json'}, { $set: {'metadata.FileName': 'DeviceDetail.json'} }, { multi: true })</p><p><br/></p><p>// Find the number of Device Detail Report Templates, filename and metadata counts should match</p><p>db.fs.files.find( { 'filename': 'DeviceDetail.json' }).count()</p><p>db.fs.files.find( { 'metadata.ReportTemplateName': 'Device Detail' }).count()</p><p><br/></p><p>// Sti Error Template -&gt; Error Template</p><p><br/></p><p>// Find the number of Templates, filename and metadata counts should match</p><p>db.fs.files.find( { 'filename': 'StiErrorTemplate.json' }).count()</p><p>db.fs.files.find( { 'metadata.ReportTemplateName': 'Sti Error Template' }).count()</p><p><br/></p><p>// Update the filename</p><p>db.fs.files.update({'filename': 'StiErrorTemplate.json'}, { $set: {'filename': 'ErrorTemplate.json'} }, { multi: true })</p><p>// Update the metadata</p><p>db.fs.files.update({'metadata.ReportTemplateName': 'Sti Error Template'}, { $set: {'metadata.ReportTemplateName': 'Error Template'} }, { multi: true })</p><p>db.fs.files.update({'metadata.FileName': 'StiErrorTemplate.json'}, { $set: {'metadata.FileName': 'ErrorTemplate.json'} }, { multi: true })</p><p><br/></p><p>// Find the number of Templates, filename and metadata counts should match</p><p>db.fs.files.find( { 'filename': 'ErrorTemplate.json' }).count()</p><p>db.fs.files.find( { 'metadata.ReportTemplateName': 'Error Template' }).count()</p></div>
</article></body></html>