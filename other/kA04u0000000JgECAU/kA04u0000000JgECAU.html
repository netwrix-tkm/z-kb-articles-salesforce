<?xml version="1.0" encoding="UTF-8"?><html><head><meta charset="utf-8"/><title>Mongo - Steve's Count Quirk</title><meta name="label" content="employees_v"/><meta name="label" content="skb"/><meta name="KnowledgeArticleId" content="kA04u0000000JgECAU"/><meta name="Id" content="ka04u000000HdBJAA0"/><meta name="LastPublishedDate" content="2022-02-07T01:00:43.000+0000"/><meta name="LastModifiedDate" content="2023-05-08T10:18:19.000+0000"/><meta name="FirstPublishedDate" content="2022-02-07T01:00:43.000+0000"/><meta name="Language" content="en_US"/><meta name="UrlName" content="8309"/><meta name="ArticleNumber" content="000008309"/><meta name="description" content="HELPDESK"/></head><body><article class=" kb-articles"><div class="Content__c"><p>I just wanted to share this with you as it was something I saw today that didn’t seem to make sense.</p><p> </p><p>I wanted to see how many documents were in the background task queue so executed : </p><p> </p><p>&gt; db.BackgroundTaskQueue.count();</p><p>156</p><p> </p><p>yet breaking this down by task “type” revealed a totally different figure :</p><p> </p><p>&gt; db.BackgroundTaskQueue.aggregate([ { $group: {_id:  { t : "$_t" }, count: { $sum : 1 } } } ]);</p><p>{ "_id" : { "t" : [ "BackgroundTask", "GenerateReportDataBackgroundTask" ] }, "count" : 54 }</p><p>{ "_id" : { "t" : [ "BackgroundTask", "DeliverReportResultBackgroundTask" ] }, "count" : 2 }</p><p>{ "_id" : { "t" : [ "BackgroundTask", "RenderReportBackgroundTask" ] }, "count" : 3 }</p><p>{ "_id" : { "t" : [ "BackgroundTask", "CollateComplianceReportDataBackgroundTask" ] }, "count" : 3 }</p><p> </p><p>(i.e 62)</p><p> </p><p>Browsing the collection in Compass also showed strange behaviour when I tried page past what was “really” there :</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="kA04u0000000JgECAU_f9da5b75-5018-4bc4-8948-5c04b076ccc9.jpg"/></span><p/><p> </p><p>i.e just a blank page.</p><p> </p><p>Apparently this can happen when Mongo experiences a crash (although I’m fairly sure my Mongo hadn’t crashed at any point) but luckily the fix is easy :</p><p> </p><p>&gt; db.BackgroundTaskQueue.validate(true)</p><p>{</p><p>                        "ns" : "NNTHubService.BackgroundTaskQueue",</p><p>                        "nInvalidDocuments" : NumberLong(0),</p><p>                        "nrecords" : 62,</p><p>                        "nIndexes" : 2,</p><p>                        "keysPerIndex" : {</p><p>                                                "_id_" : 62,</p><p>                                                "SubmittedDateTimeUtc_1" : 62</p><p>                        },</p><p>                        "indexDetails" : {</p><p>                                                "SubmittedDateTimeUtc_1" : {</p><p>                                                                        "valid" : true</p><p>                                                },</p><p>                                                "_id_" : {</p><p>                                                                        "valid" : true</p><p>                                                }</p><p>                        },</p><p>                        "valid" : true,</p><p>                        "warnings" : [ ],</p><p>                        "errors" : [ ],</p><p>                        "extraIndexEntries" : [ ],</p><p>                        "missingIndexEntries" : [ ],</p><p>                        "ok" : 1</p><p>}</p><p>&gt; db.BackgroundTaskQueue.count({});</p><p>62</p><p> </p><p> </p></div>
</article></body></html>