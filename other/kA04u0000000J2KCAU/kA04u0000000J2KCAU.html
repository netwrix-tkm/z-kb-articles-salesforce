<?xml version="1.0" encoding="UTF-8"?><html><head><meta charset="utf-8"/><title>Hotfix: SA_8.2_044</title><meta name="label" content="employees_v"/><meta name="label" content="skb"/><meta name="KnowledgeArticleId" content="kA04u0000000J2KCAU"/><meta name="Id" content="ka04u000000Hd15AAC"/><meta name="LastPublishedDate" content="2022-02-01T18:52:46.000+0000"/><meta name="LastModifiedDate" content="2023-05-08T10:13:41.000+0000"/><meta name="FirstPublishedDate" content="2022-02-01T18:52:46.000+0000"/><meta name="Language" content="en_US"/><meta name="UrlName" content="7913"/><meta name="ArticleNumber" content="000007913"/><meta name="description" content="360012326351"/></head><body><article class=" kb-articles"><div class="Content__c"><p><strong><span class="wysiwyg-font-size-large">Summary:</span></strong> Alleviate out of stackspace errors by fixing issue where many foreign keys were being created in SA DB.  This patch also contains a fix for SA failing to alter datatypes causing a "failed to apply patch" exception.  Included is a script to remove the foreign keys that cause the out of memory issues.</p><p><strong><span class="wysiwyg-font-size-large">Issue:</span></strong> <strong><span>Summary:</span></strong><br/>Alleviate out of stackspace errors by fixing issue where many foreign keys were being created in SA DB.  This patch also contains a fix for SA failing to alter datatypes causing a "failed to apply patch" exception.  Included is a script to remove the foreign keys that cause the out of memory issues.<br/><strong><span>Behavior Before Fix: </span></strong><br/>This error along with a scan timeout during scanner initialization: "The query processor ran out of stack space during query optimization, Please simplify the query.'"<br/>Also these messages in the logs: "Failed to apply patch 'SqlServer' v2: System.Exception: "<br/><strong><span>Behavior After Fix: </span></strong><br/>Initializing scanner message should now only stay visible for a few seconds and the scan should start quickly.  No additional extraneous foreign keys are created by SA in the SDD resouces table.<br/><b>Changes Since Last Hotfix:</b><br/>n/a<br/><strong><span>Submitted by: </span></strong><br/>Rob Evert<br/><strong><span>Affected Versions:</span></strong><br/>8.2<br/><strong><span>Affected Module:</span></strong><br/>SA - DC - SQL<br/> <br/><strong><span>Dev Ticket:</span></strong><br/>SAT-5353  34200 - StealthAUDIT | SQL SDD  The query processor ran out of stack space during query optimization<br/><strong><span>Resolved in Version:</span></strong><br/>DCSQL.DLL  8.2.85<br/><strong><span>KB Type: </span></strong><br/>Hotfix<br/> <br/><strong><span>Modules Included:</span></strong><br/>/DC/DCSQL.DLL  8.2.85<br/>/PrivateAssemblies/Stealthbits.StealthAUDIT.DataCollectors.dll  8.2.59<br/>/PrivateAssemblies/Stealthbits.StealthAUDIT.DataCollectors.SQL.Common.dll  8.2.85<br/>/PrivateAssemblies/Stealthbits.StealthAUDIT.DataCollectors.SQL.dll  8.2.85<br/>/PrivateAssemblies/Stealthbits.StealthAUDIT.DataCollectors.SQL.SQLServer.dll  8.2.85<br/>/PrivateAssemblies/Stealthbits.StealthAUDIT.DataCollectors.SQL.UI.dll  8.2.85<br/>/PrivateAssemblies/Stealthbits.StealthAUDIT.DataCollectors.SQL.UI.SqlServer.dll  8.2.85<br/> <br/><b>YouTrack/Escalations:</b><br/>SAT-5353/34200<br/><b>Customers</b><br/>Science Museum Groups<br/><b>Cumulative List of fixes included since Service Pack:</b><br/>SAT-4723  Performance Improvements for SQL SDD scans<br/>SAT-4462  fix for DatabasePrincipals unique key constraint<br/>SAT-4700  Fix for permissions from deleted users showing up on views<br/>SAT-4707  Retry logic added to alleviate interrupted scans from network issues<br/> </p><p><strong><span class="wysiwyg-font-size-large">Instructions:</span></strong> 1. Unblock the hotfix zip file in the windows property dialog if an unblock button exists there.<br/>2. Close all instances of StealthAUDIT (check task manager under processes for all users)<br/>3. Exit StealthAUDIT console<br/>4. Copy and replace files from the included folder into SA Install dir.<br/>5. Run the included SQL query "Clear_ForeignKeys.txt" against the SA console database.<br/>6. Run the following query against the SA console database: DELETE FROM [SA_SQL_Patches] WHERE [Patch_Source] = 'SqlServer'<br/><br/>  
</p><div class="table-wrap"><table count-columns="1" cellspacing="0" cellpadding="0" width="64" border="0"><tbody><tr height="115"><td colspan="1" rowspan="1" height="115" width="64"><a href="https://downloads.stealthbits.com/access/files/SAHotFixes/8.2/SA_8.2_044.zip" target="_blank">https://downloads.stealthbits.com/access/files/SAHotFixes/8.2/SA_8.2_044.zip</a></td></tr></tbody></table></div><p><strong><span class="wysiwyg-font-size-large">Product:</span></strong> StealthAUDIT<br/><strong><span class="wysiwyg-font-size-large">Module:</span></strong> SA - DC - SQL<br/><strong><span class="wysiwyg-font-size-large">Versions:</span></strong> 8.2<br/><strong><span class="wysiwyg-font-size-large">Dev Ticket:</span></strong> SAT-5353<br/><strong><span class="wysiwyg-font-size-large">Resolved In:</span></strong> DCSQL.DLL  8.2.85<br/><strong><span class="wysiwyg-font-size-large">Salesforce Article ID:</span></strong> 2354<br/></p></div>
</article></body></html>