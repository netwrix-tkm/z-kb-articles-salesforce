<?xml version="1.0" encoding="UTF-8"?><html><head><meta charset="utf-8"/><title>Support Process - Enabling Change Tracker's Azure AD SSO Support Internal</title><meta name="label" content="employees_v"/><meta name="label" content="skb"/><meta name="KnowledgeArticleId" content="kA04u0000000JdzCAE"/><meta name="Id" content="ka04u000000HdApAAK"/><meta name="LastPublishedDate" content="2022-02-07T01:10:42.000+0000"/><meta name="LastModifiedDate" content="2023-05-08T10:18:06.000+0000"/><meta name="FirstPublishedDate" content="2022-02-07T01:10:42.000+0000"/><meta name="Language" content="en_US"/><meta name="UrlName" content="8360"/><meta name="ArticleNumber" content="000008360"/><meta name="description" content="HELPDESK"/></head><body><article class=" kb-articles"><div class="Content__c"><p>This NNT how-to article covers the configuration changes necessary to enable Single Sign On (SSO) into Change Tracker using Microsoft Azure Active Directory as an Identity Provider (IDP).</p><p>The configuration is relatively simple, but the application must be registered with Azure before the relevant configuration changes can be applied to the Change Tracker installation. This guide will cover the necessary steps in both environments.</p><p><strong><u>For Azure SSO, your NNT Change Tracker must be version 7.4.?.? or above.</u></strong></p><p>If you are required to create / register the application with Azure, you might like to refer to the online guide <a class="external-link" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/scenario-web-app-sign-user-app-registration?tabs=aspnetcore" target="_blank">here</a> which forms the basis of this step-by-step guide. If however the application has already been created by the client, you only need collect certain settings; proceed to Configure the Change Tracker Application.</p><h2 id="SupportProcess-EnablingChangeTracker'sAzureADSSOSupportInternal-Step-by-stepguide">Step-by-step guide</h2><ul><li><p>Confirm your Change Tracker version as directed above.</p></li><li><p>Confirm the NNT Change Tracker server can communicate with the Azure servers e.g. <a class="external-link" href="https://dev-6082949.okta.com/" target="_blank">https://login.microsoftonline.com/</a> and <a class="external-link" href="https://graph.microsoft.com/" target="_blank">https://graph.microsoft.com/</a> .</p></li></ul><h3 id="SupportProcess-EnablingChangeTracker'sAzureADSSOSupportInternal-CreatetheAzureApplication:">Create the Azure Application:</h3><ul><li><p>Sign in to the <a class="external-link" href="https://portal.azure.com/" target="_blank">Azure Portal</a> with an admin level account.</p></li><li><p>If you have access to multiple tenants, use the Directories + subscriptions filter in the top menu to switch to the tenant in which you want to register the application.</p></li><li><p>Search for and select <strong>Azure Active Directory</strong>.</p></li><li><p>Under <strong>Manage</strong>, select <strong>App registrations</strong> &gt; <strong>New registration</strong>.</p></li><li><p>When the <strong>Register an application</strong> page appears, enter your application's registration information:</p><ol><li><p>Enter a <strong>Name</strong> for your application, for example <code>Change Tracker</code>. Users of your app might see this name, and you can change it later.</p></li><li><p>Choose the supported account types for your application. (See <a class="external-link" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-supported-account-types" target="_blank">Supported account types</a>.)</p></li><li><p>For <strong>Redirect URI</strong>, add the type of application <strong>Web</strong> and the URI destination that will accept returned token responses after successful authentication. For example, enter <code>https://changetracker.customer.com/api/auth/microsoftgraph</code>.</p></li><li><p>Select <strong>Register</strong>.</p></li></ol></li><li><p>Under <strong>Manage</strong>, select <strong>Authentication</strong> and then add the following information:</p><ol><li><p>Under <strong>Implicit grant and hybrid flows</strong>, select <strong>Access tokens</strong> and <strong>ID tokens</strong>.</p></li><li><p>Select <strong>Save</strong>.</p></li></ol></li><li><p>Under <strong>Manage</strong>, select <strong>Certificates &amp; secrets &gt; Client secrets &gt; New client secret</strong>.</p></li><li><p>When the <strong>Add a client secret</strong> page appears, enter the secret registration information:</p><ol><li><p>Enter a <strong>Description</strong> for the secret, and the <strong>Expiry time</strong>.</p></li><li><p>Select <strong>Add</strong>. <em>Once the secret has been created, you must copy the secret <strong>Value</strong> before leaving the page. Client secret values cannot be viewed, except for immediately after creation</em>.</p></li></ol></li><li><p>You need to copy some values into your Change Tracker configuration, so leave the Azure portal open.</p></li></ul><h3 id="SupportProcess-EnablingChangeTracker'sAzureADSSOSupportInternal-ConfiguretheChangeTrackerApplication:">Configure the Change Tracker Application:</h3><ul><li><p>Locate the configuration folder for the Change Tracker installation, and the environment-specific configuration file within, such as <code>appsettings.Production.json</code>.</p></li><li><p>Locate or add the <strong>security / oauth / microsoftgraph</strong> section as below (this can also be generated using the Maintenance application, if necessary):</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="kA04u0000000JdzCAE_1f66dc7d-b75b-4650-a136-6d15c173f160.png"/></span></li><li><p>If necessary, sign in to the <a class="external-link" href="https://portal.azure.com/" target="_blank">Azure portal</a> with an admin level account.</p></li><li><p>If you have access to multiple tenants, use the Directories + subscriptions filter in the top menu to switch to the tenant in which the application is registered.</p></li><li><p>Search for and select <strong>Azure Active Directory</strong>.</p></li><li><p>Under <strong>Manage</strong>, select <strong>App registrations</strong> &gt; <strong>Endpoints</strong>.</p></li><li><p>When the <strong>Endpoints</strong> page appears, copy the following settings to the configuration file:</p><ul><li><p>Copy the <strong>OAuth 2.0 token endpoint (v2)</strong> value to <strong>accessTokenUrl</strong> e.g. <code>https://login.microsoftonline.com/ffb29c91-6241-40f4-8e0c-d6d8048b7c1c/oauth2/v2.0/token</code>.</p></li><li><p>Copy the <strong>OAuth 2.0 authorization endpoint (v2)</strong> value to <strong>authorizeUrl</strong> e.g. <code>https://login.microsoftonline.com/ffb29c91-6241-40f4-8e0c-d6d8048b7c1c/oauth2/v2.0/authorize</code>.</p></li><li><p>Copy the <strong>Microsoft Graph API endpoint</strong> value plus <code>/v1.0/me</code>, to <strong>userProfileUrl</strong> e.g. <code>https://graph.microsoft.com/v1.0/me</code>.</p></li></ul></li><li><p>Close the <strong>Endpoints</strong> page, returning to the <strong>App registrations</strong>.</p><ul><li><p>Copy the <strong>Directory (tenant) ID</strong> value to <strong>tenant</strong> e.g. <code>ffb29c91-6241-40f4-8e0c-d6d8048b7c1c</code>.</p></li><li><p>Copy the <strong>Application (client) ID</strong> value to <strong>appId</strong></p></li></ul></li><li><p>Copy the <strong>Client secret </strong>value created with the Azure Application to <strong>appSecret</strong> (see previous section)</p></li><li><p>Copy the <strong>Redirect URI</strong> (for <strong>Web</strong> app) value created with the Azure Application to <strong>callbackUrl</strong> (see previous section). For example, enter <code>https://changetracker.customer.com/api/auth/microsoftgraph</code>. </p></li><li><p>Finally, ensure that there is an <strong>enabled</strong> key, and that it’s value is set to <code>true</code>.</p></li><li><p>Save your changes to the config file, and restart the web site.</p></li></ul><p>If the above has been correctly configured, the Change Tracker sign-in dialog should now give the option to “Sign In with Microsoft”. Click this, and you should be directed to the Microsoft site where you now sign in using credentials which have been configured there:</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="kA04u0000000JdzCAE_e9dba22b-ff8a-4ecf-afdc-399bc53b10f4.png"/></span><p>If successful, you’ll be returned to Change Tracker. The first time this happens, a user account will be created within Change Tracker and assigned any roles granted to them in Azure. NB if no roles have been granted, the user account is automatically assigned to the User role.</p></div>
</article></body></html>